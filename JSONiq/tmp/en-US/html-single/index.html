<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>JSONiq</title><link rel="stylesheet" type="text/css" href="Common_Content/css/default.css" /><link rel="stylesheet" media="print" href="Common_Content/css/print.css" type="text/css" /><meta name="generator" content="publican 3.2.1" /><meta name="package" content="JSONiq_-_the_SQL_of_NoSQL-JSONiq-1.0-en-US-1-12" /><meta name="description" content="This document provides a complete reference of the core of JSONiq, the JSON query language." /></head><body><p id="title"><a class="left" href="https://fedorahosted.org/publican"><img alt="Product Site" src="Common_Content/images//image_left.png" /></a><a class="right" href="https://fedorahosted.org/publican"><img alt="Documentation Site" src="Common_Content/images//image_right.png" /></a></p><div class="book"><div class="titlepage"><div><div class="producttitle"><span class="productname">JSONiq - the SQL of NoSQL</span> <span class="productnumber">1.0</span></div><div><h1 class="title"><a id="idm140319531193424"></a>JSONiq</h1></div><div><h2 class="subtitle">The complete reference</h2></div><p class="edition">Edition 1.0.12</p><div><h3 class="corpauthor">
		<span class="inlinemediaobject"><img src="images/28.png" width="111" /></span>

	</h3></div><div><div class="authorgroup"><div class="author"><h3 class="author"><span class="firstname">Jonathan</span> <span class="surname">Robie</span></h3><code class="email"><a class="email" href="mailto:jonathan.robie@gmail.com">jonathan.robie@gmail.com</a></code></div><div class="author"><h3 class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></h3><code class="email"><a class="email" href="mailto:ghislain.fourny@28msec.com">ghislain.fourny@28msec.com</a></code></div><div class="author"><h3 class="author"><span class="firstname">Matthias</span> <span class="surname">Brantner</span></h3><code class="email"><a class="email" href="mailto:matthias.brantner@28msec.com">matthias.brantner@28msec.com</a></code></div><div class="author"><h3 class="author"><span class="firstname">Daniela</span> <span class="surname">Florescu</span></h3><code class="email"><a class="email" href="mailto:dana.florescu@oracle.com">dana.florescu@oracle.com</a></code></div><div class="author"><h3 class="author"><span class="firstname">Till</span> <span class="surname">Westmann</span></h3><code class="email"><a class="email" href="mailto:till.westmann@28msec.com">till.westmann@28msec.com</a></code></div><div class="author"><h3 class="author"><span class="firstname">Markos</span> <span class="surname">Zaharioudakis</span></h3><code class="email"><a class="email" href="mailto:markos.zaharioudakis@oracle.com">markos.zaharioudakis@oracle.com</a></code></div><div class="editor"><h4 class="editedby">Edited by</h4><h3 class="editor"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></h3><div class="affiliation"><span class="orgname">28msec, Inc.</span></div><code class="email"><a class="email" href="mailto:ghislain.fourny@28msec.com">ghislain.fourny@28msec.com</a></code></div></div></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
			This document provides a complete reference of the core of JSONiq, the JSON query language.
		</div></div></div></div></div><div class="toc"><dl class="toc"><dt><span class="chapter"><a href="#chapter-introduction">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319530504000">1.1. Why JSONiq?</a></span></dt><dt><span class="section"><a href="#idm140319521903744">1.2. Structure of a JSONiq program.</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter-data-model">2. JSON and the JSONiq data model</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319524710784">2.1. JSON</a></span></dt><dt><span class="section"><a href="#idm140319572806288">2.2. JSONiq values</a></span></dt><dt><span class="section"><a href="#idm140319529833680">2.3. Objects</a></span></dt><dt><span class="section"><a href="#idm140319526384160">2.4. Arrays</a></span></dt><dt><span class="section"><a href="#idm140319526382304">2.5. Atomics</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter-collections">3. Collections</a></span></dt><dt><span class="chapter"><a href="#chapter-type-system">4. JSONiq types</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319524575008">4.1. Item types</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319529563664">4.1.1. Atomics</a></span></dt><dt><span class="section"><a href="#idm140319523008448">4.1.2. JSON items</a></span></dt><dt><span class="section"><a href="#idm140319529411696">4.1.3. The most general item type.</a></span></dt></dl></dd><dt><span class="section"><a href="#idm140319529407056">4.2. Sequence types</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter-expressions">5. Expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#chapter-construction">5.1. Construction of items</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319569897248">5.1.1. Atomic literals</a></span></dt><dt><span class="section"><a href="#idm140319531217664">5.1.2. Object constructors</a></span></dt><dt><span class="section"><a href="#idm140319561946896">5.1.3. Array constructors</a></span></dt><dt><span class="section"><a href="#idm140319516360464">5.1.4. Composing constructors</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-basic-operations">5.2. Basic operations</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319526655920">5.2.1. Construction of sequences</a></span></dt><dt><span class="section"><a href="#idm140319523355840">5.2.2. Parenthesized expression</a></span></dt><dt><span class="section"><a href="#idm140319566044464">5.2.3. Arithmetics</a></span></dt><dt><span class="section"><a href="#idm140319558533104">5.2.4. String concatenation</a></span></dt><dt><span class="section"><a href="#idm140319558334752">5.2.5. Comparison</a></span></dt><dt><span class="section"><a href="#idm140319515318448">5.2.6. Logics</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-function-calls">5.3. Function Calls</a></span></dt><dt><span class="section"><a href="#chapter-selectors">5.4. Selectors</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319530191904">5.4.1. Object field selector</a></span></dt><dt><span class="section"><a href="#idm140319516341920">5.4.2. Array member selector</a></span></dt><dt><span class="section"><a href="#idm140319517629088">5.4.3. Sequence predicates</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-control-flow">5.5. Control flow expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319561116016">5.5.1. Conditional expressions</a></span></dt><dt><span class="section"><a href="#idm140319570202912">5.5.2. Switch expressions</a></span></dt><dt><span class="section"><a href="#idm140319576130064">5.5.3. Try-catch expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-flwor">5.6. FLWOR expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319581287120">5.6.1. For clauses</a></span></dt><dt><span class="section"><a href="#idm140319531205952">5.6.2. Where clauses</a></span></dt><dt><span class="section"><a href="#idm140319557688352">5.6.3. Order clauses</a></span></dt><dt><span class="section"><a href="#idm140319531443008">5.6.4. Group clauses</a></span></dt><dt><span class="section"><a href="#idm140319572574592">5.6.5. Let clauses</a></span></dt><dt><span class="section"><a href="#idm140319558358448">5.6.6. Count clauses</a></span></dt><dt><span class="section"><a href="#idm140319558197472">5.6.7. Map operator</a></span></dt><dt><span class="section"><a href="#idm140319510903872">5.6.8. Composing FLWOR expressions</a></span></dt><dt><span class="section"><a href="#idm140319558698368">5.6.9. Ordered and Unordered expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#section-type-expressions">5.7. Expressions dealing with types</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319571340912">5.7.1. Instance-of expressions</a></span></dt><dt><span class="section"><a href="#idm140319568782224">5.7.2. Treat expressions</a></span></dt><dt><span class="section"><a href="#idm140319558338832">5.7.3. Castable expressions</a></span></dt><dt><span class="section"><a href="#idm140319567052960">5.7.4. Cast expressions</a></span></dt><dt><span class="section"><a href="#idm140319567589168">5.7.5. Typeswitch expressions</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#chapter-prolog">6. Prologs</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319522574800">6.1. Setters.</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319557378272">6.1.1. Default collation</a></span></dt><dt><span class="section"><a href="#idm140319525305456">6.1.2. Default ordering mode</a></span></dt><dt><span class="section"><a href="#idm140319523035840">6.1.3. Default ordering behaviour for empty sequences</a></span></dt><dt><span class="section"><a href="#idm140319531498784">6.1.4. Default decimal format</a></span></dt></dl></dd><dt><span class="section"><a href="#idm140319521861776">6.2. Global variables</a></span></dt><dt><span class="section"><a href="#idm140319531450384">6.3. Functions</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter-modules">7. Modules</a></span></dt><dt><span class="chapter"><a href="#chapter-functions">8. Function Library</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319530076720">8.1. JSON specific functions.</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319579609680">8.1.1. keys</a></span></dt><dt><span class="section"><a href="#idm140319531592560">8.1.2. members</a></span></dt><dt><span class="section"><a href="#idm140319574095632">8.1.3. null</a></span></dt><dt><span class="section"><a href="#idm140319527785856">8.1.4. parse-json</a></span></dt><dt><span class="section"><a href="#idm140319566787104">8.1.5. size</a></span></dt><dt><span class="section"><a href="#idm140319579649520">8.1.6. accumulate</a></span></dt><dt><span class="section"><a href="#idm140319579647424">8.1.7. descendant-arrays</a></span></dt><dt><span class="section"><a href="#idm140319525340464">8.1.8. descendant-objects</a></span></dt><dt><span class="section"><a href="#idm140319525338352">8.1.9. descendant-pairs</a></span></dt><dt><span class="section"><a href="#idm140319525333328">8.1.10. flatten</a></span></dt><dt><span class="section"><a href="#idm140319511852528">8.1.11. intersect</a></span></dt><dt><span class="section"><a href="#idm140319511850192">8.1.12. project</a></span></dt><dt><span class="section"><a href="#idm140319511841872">8.1.13. remove-keys</a></span></dt><dt><span class="section"><a href="#idm140319517688912">8.1.14. values</a></span></dt><dt><span class="section"><a href="#idm140319517686928">8.1.15. encode-for-roundtrip</a></span></dt><dt><span class="section"><a href="#idm140319517684208">8.1.16. decode-from-roundtrip</a></span></dt></dl></dd><dt><span class="section"><a href="#idm140319517681712">8.2. Functions taken from XQuery</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter-equality-and-identity">9. Equality and identity</a></span></dt><dt><span class="chapter"><a href="#chapter-areas-of-confusion">10. Notes</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319528191744">10.1. Sequences vs. Arrays</a></span></dt><dt><span class="section"><a href="#idm140319527541408">10.2. Null vs. empty sequence</a></span></dt></dl></dd><dt><span class="chapter"><a href="#chapter-open-issues">11. Open Issues</a></span></dt><dt><span class="appendix"><a href="#appe-JSONiq-Revision_History">A. Revision History</a></span></dt><dt><span class="index"><a href="#idm140319522770832">Index</a></span></dt></dl></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-introduction"></a>Chapter 1. Introduction</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#idm140319530504000">1.1. Why JSONiq?</a></span></dt><dt><span class="section"><a href="#idm140319521903744">1.2. Structure of a JSONiq program.</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319530504000"></a>1.1. Why JSONiq?</h2></div></div></div><div class="para">
			JSONiq is a query and processing language specifically designed for the popular JSON data model. The main ideas behind JSONiq are based on lessons learned in more than 30 years of relational query systems and more than 15 years of experience with designing and implementing query languages for semi-structured data like XML and RDF.
		</div><div class="para">
			The main source of inspiration behind JSONiq is XQuery, which has been proven so far a successful and productive query language for semi-structured data (in particular XML). JSONiq borrowed a large numbers of ideas from XQuery, like the structure and semantics of a FLWOR construct, the functional aspect of the language, the semantics of comparisons in the face of data heterogeneity, the declarative, snapshot-based updates. However, unlike XQuery, JSON is not concerned with the peculiarities of XML, like mixed content, ordered children, the confusion between attributes and elements, the complexities of namespaces and QNames, or the complexities of XML Schema, and so on.
		</div><div class="para">
			The power of the XQuery's FLWOR construct and the functional aspect, combined with the simplicity of the JSON data model result in a clean, sleek and easy to understand data processing language. As a matter of fact, JSONiq is a language that can do more than queries: it can describe powerful data processing programs, from transformations, selections, joins of heterogeneous data sets, data enrichment, information extraction, information cleaning, and so on.
		</div><div class="para">
			Technically, the main characteristics of JSONiq (and XQuery) are the following:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					It is a <span class="emphasis"><em>set-oriented language</em></span>. While most programming languages are designed to manipulate one object at a time, JSONiq is designed to process sets (actually, sequences) of data objects.
				</div></li><li class="listitem"><div class="para">
					It is a <span class="emphasis"><em>functional language</em></span>. A JSONiq program is an expression; the result of the program is the result of the evaluation of the expression. Expressions have fundamental role in the language: every language construct is an expression, and expressions are fully composable.
				</div></li><li class="listitem"><div class="para">
					It is a <span class="emphasis"><em>declarative language</em></span>. A program specifies what is the result being calculated, and does not specify low level algorithms like the sort algorithm, the fact that an algorithm is executed in main memory or is external, on a single machine or parallelized on several machines, or what access patterns (aka indexes) are being used during the evaluation of the program. Such implementation decisions should be taken automatically, by an optimizer, based on the physical characteristics of the data, and of the hardware environment. Just like a traditional database would do. The language has been designed from day one with optimizability in mind.
				</div></li><li class="listitem"><div class="para">
					It is designed for <span class="emphasis"><em>nested, heterogeneous, semi-structured data</em></span>. Data structures in JSON can be nested with arbitrary depth, do not have a specific type pattern (i.e. are heterogeneous), and may or may not have one or more schemas that describe the data. Even in the case of a schema, such a schema can be open, and/or simply partially describe the data. Unlike SQL, which is designed to query tabular, flat, homogeneous structures. JSONiq has been designed from scratch as a query for nested and heterogeneous data.
				</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319521903744"></a>1.2. Structure of a JSONiq program.</h2></div></div></div><div class="figure"><a id="idm140319521902976"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Module.png" alt="Module" /></div></div><p class="title"><strong>Figure 1.1. Module</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319512625392"></a><div class="figure-contents"><div class="mediaobject"><img src="images/MainModule.png" alt="MainModule" /></div></div><p class="title"><strong>Figure 1.2. MainModule</strong></p></div><br class="figure-break" /><div class="para">
			A main JSONiq program is made of two parts: an optional prolog, and an expression, which is the main query.
		</div><div class="para">
			The result of the main JSONiq program is the result of its main query.
		</div><div class="para">
			In the prolog, it is possible to declare global variables and functions. Mostly, you will recognize a prolog declaration by the semi-colon it ends with. The main query does not contain semi-colons (at least in core JSONiq).
		</div><div class="figure"><a id="idm140319528136992"></a><div class="figure-contents"><div class="mediaobject"><img src="images/LibraryModule.png" alt="LibraryModule" /></div></div><p class="title"><strong>Figure 1.3. LibraryModule</strong></p></div><br class="figure-break" /><div class="para">
			Library modules do not contain any main query, just global variables and functions. They can be imported by other modules.
		</div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-data-model"></a>Chapter 2. JSON and the JSONiq data model</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#idm140319524710784">2.1. JSON</a></span></dt><dt><span class="section"><a href="#idm140319572806288">2.2. JSONiq values</a></span></dt><dt><span class="section"><a href="#idm140319529833680">2.3. Objects</a></span></dt><dt><span class="section"><a href="#idm140319526384160">2.4. Arrays</a></span></dt><dt><span class="section"><a href="#idm140319526382304">2.5. Atomics</a></span></dt></dl></div><div class="para">
		JSONiq is a query language that was specifically designed for native JSON support.
	</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319524710784"></a>2.1. JSON</h2></div></div></div><div class="para">
			As stated on json.org, JSON is a <span class="quote">“<span class="quote"> lightweight data-interchange format. It is easy for humans to read and write. It is easy for machines to parse and generate. </span>”</span>
		</div><div class="para">
			A JSON document is made of the following building blocks: objects, arrays, strings, numbers, booleans and nulls.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319572806288"></a>2.2. JSONiq values</h2></div></div></div><div class="para">
			JSONiq manipulates sequences of these building blocks, which are called items. Hence, a JSONiq value is a sequence of items.
		</div><div class="para">
			Any JSONiq expression takes and returns sequences of items.
		</div><div class="para">
			Comma-separated JSON-like building blocks is all you need to begin building your own sequences. You can mix and match!
		</div><div class="example"><a id="idm140319571830752"></a><p class="title"><strong>Example 2.1. A sequence</strong></p><div class="example-contents"><pre class="programlisting">
  "foo", 2, true, { "foo", "bar" }, null, [ 1, 2, 3 ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo 2 true foo bar null [ 1, 2, 3 ]
				</div></div></div><br class="example-break" /><div class="para">
			Sequences are flat and cannot be nested. This makes streaming possible, which is very powerful.
		</div><div class="example"><a id="idm140319570123424"></a><p class="title"><strong>Example 2.2. Sequences are flat</strong></p><div class="example-contents"><pre class="programlisting">
  ( ("foo", 2), ( (true, 4, null), 6 ) )
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo 2 true 4 null 6
				</div></div></div><br class="example-break" /><div class="para">
			A sequence can be empty. The empty sequence can be constructed with empty parentheses.
		</div><div class="example"><a id="idm140319570112064"></a><p class="title"><strong>Example 2.3. The empty sequence</strong></p><div class="example-contents"><pre class="programlisting">
  ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /><div class="para">
			A sequence of just one item is considered the same as just this item. Whenever we say that an expression returns or takes one item, we really mean that it takes a singleton sequence of one item.
		</div><div class="example"><a id="idm140319521497728"></a><p class="title"><strong>Example 2.4. A sequence of one item</strong></p><div class="example-contents"><pre class="programlisting">
  ("foo")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo
				</div></div></div><br class="example-break" /><div class="para">
			JSONiq classifies the items mentioned above in two categories:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					JSON items: objects and arrays.
				</div></li><li class="listitem"><div class="para">
					Atomics: strings, numbers, booleans and nulls.
				</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319529833680"></a>2.3. Objects</h2></div></div></div><div class="para">
			An object represents a JSON object: an unordered collection of string/value pairs.
		</div><div class="para">
			Each pair consists of an atomic of type <code class="code">string</code> and of an item.
		</div><div class="para">
			No two pairs have the same name (using Unicode character-wise comparison.)
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319526384160"></a>2.4. Arrays</h2></div></div></div><div class="para">
			An array represents a JSON array: an ordered list of items.
		</div><div class="para">
			An array can be seen as a materialized sequence, wrapped in one single item.
		</div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319526382304"></a>2.5. Atomics</h2></div></div></div><div class="para">
			An atomic is a non-structured value that is annotated with a type.
		</div><div class="para">
			JSONiq defines the following built-in atomic types. Note that JSON numbers correspond to three different types in JSONiq.
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					<span class="emphasis"><em>string</em></span>: all JSON strings.
				</div></li><li class="listitem"><div class="para">
					<span class="emphasis"><em>integer</em></span>: all JSON numbers that are integers (no dot, no exponent), infinite range.
				</div></li><li class="listitem"><div class="para">
					<span class="emphasis"><em>decimal</em></span>: all JSON numbers that are decimals (no exponent), infinite range.
				</div></li><li class="listitem"><div class="para">
					<span class="emphasis"><em>double</em></span>: IEEE double-precision 64-bit floating point numbers (corresponds to JSON numbers with an exponent).
				</div></li><li class="listitem"><div class="para">
					<span class="emphasis"><em>boolean</em></span>: the JSON booleans true and false.
				</div></li><li class="listitem"><div class="para">
					<span class="emphasis"><em>null</em></span>: the JSON null.
				</div></li></ul></div><div class="para">
			JSONiq also offers many other types of atomics. They are described in Chapter <a class="xref" href="#chapter-type-system">Chapter 4, <em>JSONiq types</em></a>.
		</div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-collections"></a>Chapter 3. Collections</h1></div></div></div><div class="para">
		Even though you can build your own JSON values with JSONiq by copying-and-pasting JSON documents, most of the time, your JSON data will be in a collection. Collections are sequences of objects, identified by a name which is a string.
	</div><div class="para">
		Adding or deleting collections from the set of known collections to a query processor, and loading the data in a collection are implementation-dependent and outside of the scope of this specification.
	</div><div class="para">
		The collection() function returns all objects associated with the provided collection name.
	</div><div class="example"><a id="idm140319526076496"></a><p class="title"><strong>Example 3.1. Getting all objects from a collection</strong></p><div class="example-contents"><pre class="programlisting">
collection("one-object")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				{ "foo" : "bar" }
			</div></div></div><br class="example-break" /><div class="para">
		For illustrative purposes, we will assume that we have the following collections:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				<span class="emphasis"><em>collection("one-object")</em></span>
			</div><pre class="programlisting">
{ "foo" : "bar" }
</pre></li><li class="listitem"><div class="para">
				<span class="emphasis"><em>collection("captains")</em></span>
			</div><pre class="programlisting">
      { "name" : "James T. Kirk", "series" : [ "The original series" ], "century" : 23 }
      { "name" : "Jean-Luc Picard", "series" : [ "The next generation" ], "century" : 24 }
      { "name" : "Benjamin Sisko", "series" : [ "The next generation", "Deep Space 9" ], "century" : 24 }
      { "name" : "Kathryn Janeway", "series" : [ "The next generation", "Voyager" ], "century" : 24  }
      { "name" : "Jonathan Archer", "series" : [ "Entreprise" ], "century" : 22 }
      { "codename" : "Emergency Command Hologram", "surname" : "The Doctor", "series" : [ "Voyager" ], "century" : 24 }
      { "name" : "Samantha Carter", "series" : [ ], "century" : 21 }
</pre></li><li class="listitem"><div class="para">
				<span class="emphasis"><em>collection("films")</em></span>
			</div><pre class="programlisting">
        { "id" : "I", "name" : "The Motion Picture", "captain" : "James T. Kirk" }
        { "id" : "II", "name" : "The Wrath of Kahn", "captain" : "James T. Kirk" }
        { "id" : "III", "name" : "The Search for Spock", "captain" : "James T. Kirk" }
        { "id" : "IV", "name" : "The Voyage Home", "captain" : "James T. Kirk" }
        { "id" : "V", "name" : "The Final Frontier", "captain" : "James T. Kirk" }
        { "id" : "VI", "name" : "The Undiscovered Country", "captain" : "James T. Kirk" }
        { "id" : "VII", "name" : "Generations", "captain" : [ "James T. Kirk", "Jean-Luc Picard" ] }
        { "id" : "VIII", "name" : "First Contact", "captain" : "Jean-Luc Picard" }
        { "id" : "IX", "name" : "Insurrection", "captain" : "Jean-Luc Picard" }
        { "id" : "X", "name" : "Nemesis", "captain" : "Jean-Luc Picard" }
        { "id" : "XI", "name" : "Star Trek", "captain" : "Spock" }
        { "id" : "XII", "name" : "Star Trek Into Darkness", "captain" : "Spock" }
</pre></li></ul></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-type-system"></a>Chapter 4. JSONiq types</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#idm140319524575008">4.1. Item types</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319529563664">4.1.1. Atomics</a></span></dt><dt><span class="section"><a href="#idm140319523008448">4.1.2. JSON items</a></span></dt><dt><span class="section"><a href="#idm140319529411696">4.1.3. The most general item type.</a></span></dt></dl></dd><dt><span class="section"><a href="#idm140319529407056">4.2. Sequence types</a></span></dt></dl></div><div class="para">
		This section describes JSONiq types as well as the sequence type syntax.
	</div><div class="para">
		JSONiq manipulates semi-structured data: in general, JSONiq allows you, but does not require you to specify types. So you have as much or as little type verification as you wish.
	</div><div class="para">
		JSONiq is still strongly typed, so that you will be told if there is a type inconsistency or mismatch in your programs.
	</div><div class="para">
		Whenever you do not specify the type of a variable or the type signature of a function, the most general type for any sequence of items, item*, is assumed.
	</div><div class="para">
		Section <a class="xref" href="#section-type-expressions">Section 5.7, “Expressions dealing with types”</a> introduces expressions which work with values of these types, as well as type operations (variable types, casts, ...).
	</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319524575008"></a>4.1. Item types</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319529563664"></a>4.1.1. Atomics</h3></div></div></div><div class="figure"><a id="idm140319526085472"></a><div class="figure-contents"><div class="mediaobject"><img src="images/AtomicType.png" alt="AtomicOrUnionType" /></div></div><p class="title"><strong>Figure 4.1. AtomicOrUnionType</strong></p></div><br class="figure-break" /><div class="para">
				Atomic types are organized in a tree hierarchy.
			</div><div class="para">
				JSONiq defines the following build-in types that have a direct relation with JSON:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<span class="emphasis"><em>string</em></span>: the value space is all strings made of Unicode characters.
					</div><div class="para">
						All string literals build an atomic which matches string.
					</div></li><li class="listitem"><div class="para">
						<span class="emphasis"><em>integer</em></span>: the value space is that of all mathematical integral numbers (N), with an infinite range. This is a subtype of <span class="emphasis"><em>decimal</em></span>, so that all integers also match the item type <span class="emphasis"><em>decimal</em></span>.
					</div><div class="para">
						All integer literals build an atomic which matches integer.
					</div></li><li class="listitem"><div class="para">
						<span class="emphasis"><em>decimal</em></span>: the value space is that of all mathematical decimal numbers (D), with an infinite range.
					</div><div class="para">
						All decimal literals build an atomic which matches decimal.
					</div></li><li class="listitem"><div class="para">
						<span class="emphasis"><em>double</em></span>: the value space is that of all IEEE double-precision 64-bit floating point numbers.
					</div><div class="para">
						All double literals build an atomic which matches double.
					</div></li><li class="listitem"><div class="para">
						<span class="emphasis"><em>boolean</em></span>: the value space contains the booleans true and false.
					</div><div class="para">
						All boolean literals build an atomic which matches boolean.
					</div></li><li class="listitem"><div class="para">
						<span class="emphasis"><em>null</em></span>: the value space is a singleton and only contains null.
					</div><div class="para">
						All null literals build an atomic which matches null.
					</div></li><li class="listitem"><div class="para">
						<span class="emphasis"><em>atomic</em></span>: all atomic types.
					</div><div class="para">
						All literals build an atomic which matches atomic.
					</div></li></ul></div><div class="para">
				JSONiq also supports further atomic types, which were borrowed from <a href="http://www.w3.org/TR/xmlschema11-2/#built-in-datatypes">XML Schema</a>.
			</div><div class="para">
				These datatypes are already used as a set of atomic datatypes by the other two semi-structured data formats of the Web: XML and RDF, as well as by the corresponding query languages: XQuery and SPARQL, so it is natural for a complete JSON data model to reuse them.
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						Further number types: long, int, short, byte, float.
					</div></li><li class="listitem"><div class="para">
						Date or time types: date, dateTime, dateTimeStamp, gDay, gMonth, gMonthDay, gYear, gYearMonth, time.
					</div></li><li class="listitem"><div class="para">
						Duration types: duration, dayTimeDuration, yearMonthDuration.
					</div></li><li class="listitem"><div class="para">
						Binary types: base64Binary, hexBinary.
					</div></li><li class="listitem"><div class="para">
						An URI type: anyURI.
					</div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319523008448"></a>4.1.2. JSON items</h3></div></div></div><div class="figure"><a id="idm140319523007648"></a><div class="figure-contents"><div class="mediaobject"><img src="images/JSONItemTest.png" alt="JSONItemTest" /></div></div><p class="title"><strong>Figure 4.2. JSONItemTest</strong></p></div><br class="figure-break" /><div class="para">
				All objects match the item type <span class="emphasis"><em>object</em></span> as well as <span class="emphasis"><em>json-item</em></span>.
			</div><div class="para">
				All arrays match the item type <span class="emphasis"><em>array</em></span> as well as <span class="emphasis"><em>json-item</em></span>.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319529411696"></a>4.1.3. The most general item type.</h3></div></div></div><div class="para">
				All items match the item type <span class="emphasis"><em>item</em></span>.
			</div><div class="figure"><a id="idm140319529410000"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ItemType.png" alt="ItemType" /></div></div><p class="title"><strong>Figure 4.3. ItemType</strong></p></div><br class="figure-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319529407056"></a>4.2. Sequence types</h2></div></div></div><div class="figure"><a id="idm140319529406256"></a><div class="figure-contents"><div class="mediaobject"><img src="images/SequenceType.png" alt="SequenceType" /></div></div><p class="title"><strong>Figure 4.4. SequenceType</strong></p></div><br class="figure-break" /><div class="para">
			A sequence is an ordered list of items.
		</div><div class="para">
			All sequences match the sequence type <span class="emphasis"><em>item*</em></span>.
		</div><div class="para">
			A sequence type is made of an item type followed by an occurrence indicator:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					* stands for a sequence of any length (zero or more)
				</div></li><li class="listitem"><div class="para">
					+ stands for a non-empty sequence (one or more)
				</div></li><li class="listitem"><div class="para">
					? stands for an empty or a singleton sequence (zero or one)
				</div></li><li class="listitem"><div class="para">
					The absence of indicator stands for a singleton sequence (one).
				</div></li></ul></div><div class="para">
			Examples:
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					string matches any singleton sequence containing a string.
				</div></li><li class="listitem"><div class="para">
					item+ matches any non-empty sequence.
				</div></li><li class="listitem"><div class="para">
					object? matches the empty sequence and any sequence containing one object.
				</div></li></ul></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-expressions"></a>Chapter 5. Expressions</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#chapter-construction">5.1. Construction of items</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319569897248">5.1.1. Atomic literals</a></span></dt><dt><span class="section"><a href="#idm140319531217664">5.1.2. Object constructors</a></span></dt><dt><span class="section"><a href="#idm140319561946896">5.1.3. Array constructors</a></span></dt><dt><span class="section"><a href="#idm140319516360464">5.1.4. Composing constructors</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-basic-operations">5.2. Basic operations</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319526655920">5.2.1. Construction of sequences</a></span></dt><dt><span class="section"><a href="#idm140319523355840">5.2.2. Parenthesized expression</a></span></dt><dt><span class="section"><a href="#idm140319566044464">5.2.3. Arithmetics</a></span></dt><dt><span class="section"><a href="#idm140319558533104">5.2.4. String concatenation</a></span></dt><dt><span class="section"><a href="#idm140319558334752">5.2.5. Comparison</a></span></dt><dt><span class="section"><a href="#idm140319515318448">5.2.6. Logics</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-function-calls">5.3. Function Calls</a></span></dt><dt><span class="section"><a href="#chapter-selectors">5.4. Selectors</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319530191904">5.4.1. Object field selector</a></span></dt><dt><span class="section"><a href="#idm140319516341920">5.4.2. Array member selector</a></span></dt><dt><span class="section"><a href="#idm140319517629088">5.4.3. Sequence predicates</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-control-flow">5.5. Control flow expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319561116016">5.5.1. Conditional expressions</a></span></dt><dt><span class="section"><a href="#idm140319570202912">5.5.2. Switch expressions</a></span></dt><dt><span class="section"><a href="#idm140319576130064">5.5.3. Try-catch expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#chapter-flwor">5.6. FLWOR expressions</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319581287120">5.6.1. For clauses</a></span></dt><dt><span class="section"><a href="#idm140319531205952">5.6.2. Where clauses</a></span></dt><dt><span class="section"><a href="#idm140319557688352">5.6.3. Order clauses</a></span></dt><dt><span class="section"><a href="#idm140319531443008">5.6.4. Group clauses</a></span></dt><dt><span class="section"><a href="#idm140319572574592">5.6.5. Let clauses</a></span></dt><dt><span class="section"><a href="#idm140319558358448">5.6.6. Count clauses</a></span></dt><dt><span class="section"><a href="#idm140319558197472">5.6.7. Map operator</a></span></dt><dt><span class="section"><a href="#idm140319510903872">5.6.8. Composing FLWOR expressions</a></span></dt><dt><span class="section"><a href="#idm140319558698368">5.6.9. Ordered and Unordered expressions</a></span></dt></dl></dd><dt><span class="section"><a href="#section-type-expressions">5.7. Expressions dealing with types</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319571340912">5.7.1. Instance-of expressions</a></span></dt><dt><span class="section"><a href="#idm140319568782224">5.7.2. Treat expressions</a></span></dt><dt><span class="section"><a href="#idm140319558338832">5.7.3. Castable expressions</a></span></dt><dt><span class="section"><a href="#idm140319567052960">5.7.4. Cast expressions</a></span></dt><dt><span class="section"><a href="#idm140319567589168">5.7.5. Typeswitch expressions</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="chapter-construction"></a>5.1. Construction of items</h2></div></div></div><div class="para">
		This will not come as a surprise since JSONiq is tailor-made: the items mentioned in the former section are constructed... exactly as they are constructed in JSON. Yes, you already know some JSONiq: any JSON document is also a valid JSONiq query which just "returns itself"!
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319569897248"></a>5.1.1. Atomic literals</h3></div></div></div><div class="figure"><a id="idm140319569897856"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Literal.png" alt="Literal" /></div></div><p class="title"><strong>Figure 5.1. Literal</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319569900720"></a><div class="figure-contents"><div class="mediaobject"><img src="images/NumericLiteral.png" alt="NumericLiteral" /></div></div><p class="title"><strong>Figure 5.2. NumericLiteral</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319569903168"></a><div class="figure-contents"><div class="mediaobject"><img src="images/IntegerLiteral.png" alt="IntegerLiteral" /></div></div><p class="title"><strong>Figure 5.3. IntegerLiteral</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319569905664"></a><div class="figure-contents"><div class="mediaobject"><img src="images/DecimalLiteral.png" alt="DecimalLiteral" /></div></div><p class="title"><strong>Figure 5.4. DecimalLiteral</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319569908512"></a><div class="figure-contents"><div class="mediaobject"><img src="images/DoubleLiteral.png" alt="DoubleLiteral" /></div></div><p class="title"><strong>Figure 5.5. DoubleLiteral</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319569911856"></a><div class="figure-contents"><div class="mediaobject"><img src="images/StringLiteral.png" alt="StringLiteral" /></div></div><p class="title"><strong>Figure 5.6. StringLiteral</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319569914608"></a><div class="figure-contents"><div class="mediaobject"><img src="images/BooleanLiteral.png" alt="BooleanLiteral" /></div></div><p class="title"><strong>Figure 5.7. BooleanLiteral</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319569916864"></a><div class="figure-contents"><div class="mediaobject"><img src="images/NullLiteral.png" alt="NullLiteral" /></div></div><p class="title"><strong>Figure 5.8. NullLiteral</strong></p></div><br class="figure-break" /><div class="para">
			The syntax for creating strings, numbers, booleans and nulls is identical to that of JSON (it is actually a more flexible superset, for example leading 0s are allowed, and a decimal literal can begin with a dot). Note that JSONiq distinguishes between integers (no dot, no scientific notation), decimals (dot but no scientific notation) and doubles (scientific notation). As expected, an integer literal creates an atomic of type integer, and so on. No surprises. JSON's backslash escaping is supported in string literals. Also, like in JSON, double quotes are required and single quotes are forbidden.
		</div><div class="example"><a id="idm140319569919792"></a><p class="title"><strong>Example 5.1. String literals</strong></p><div class="example-contents"><pre class="programlisting">
"foo"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569922768"></a><p class="title"><strong>Example 5.2. String literals with escaping</strong></p><div class="example-contents"><pre class="programlisting">
"This is a line\nand this is a new line"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					This is a line and this is a new line
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569925680"></a><p class="title"><strong>Example 5.3. String literals with Unicode character escaping</strong></p><div class="example-contents"><pre class="programlisting">
"\u0001"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					&amp;#x1;
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569928656"></a><p class="title"><strong>Example 5.4. String literals with a nested quote</strong></p><div class="example-contents"><pre class="programlisting">
"This is a nested \"quote\""
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					This is a nested "quote"
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569931552"></a><p class="title"><strong>Example 5.5. Integer literals</strong></p><div class="example-contents"><pre class="programlisting">
42
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					42
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569934192"></a><p class="title"><strong>Example 5.6. Decimal literals</strong></p><div class="example-contents"><pre class="programlisting">
3.14
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					3.14
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569937696"></a><p class="title"><strong>Example 5.7. Double literals</strong></p><div class="example-contents"><pre class="programlisting">
+6.022E23
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					6.022E23
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569940560"></a><p class="title"><strong>Example 5.8. Boolean literals (true)</strong></p><div class="example-contents"><pre class="programlisting">
true
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569943424"></a><p class="title"><strong>Example 5.9. Boolean literals (false)</strong></p><div class="example-contents"><pre class="programlisting">
false
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319531213456"></a><p class="title"><strong>Example 5.10. Null literals</strong></p><div class="example-contents"><pre class="programlisting">
null
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					null
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319531217664"></a>5.1.2. Object constructors</h3></div></div></div><div class="figure"><a id="idm140319531217344"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ObjectConstructor.png" alt="ObjectConstructor" /></div></div><p class="title"><strong>Figure 5.9. ObjectConstructor</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319531219600"></a><div class="figure-contents"><div class="mediaobject"><img src="images/PairConstructor.png" alt="PairConstructor" /></div></div><p class="title"><strong>Figure 5.10. PairConstructor</strong></p></div><br class="figure-break" /><div class="para">
			The syntax for creating objects is identical to that of JSON. You can use for an object key any string literal, and for an object value any literal, object constructor or array constructor.
		</div><div class="example"><a id="idm140319531223008"></a><p class="title"><strong>Example 5.11. Empty object constructors</strong></p><div class="example-contents"><pre class="programlisting">
{}
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319531226496"></a><p class="title"><strong>Example 5.12. Object constructors 1</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : "bar" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319527036032"></a><p class="title"><strong>Example 5.13. Object constructors 2</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : [ 1, 2, 3, 4, 5, 6 ] }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : [ 1, 2, 3, 4, 5, 6 ] }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319527038944"></a><p class="title"><strong>Example 5.14. Object constructors 3</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : true, "bar" : false }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : true, "bar" : false }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319527041776"></a><p class="title"><strong>Example 5.15. Nested object constructors</strong></p><div class="example-contents"><pre class="programlisting">
{ "this is a key" : { "value" : "a value" } }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "this is a key" : { "value" : "a value" } }
				</div></div></div><br class="example-break" /><div class="para">
			Oh, and like in JavaScript, if your key is simple enough (like alphanumerics, underscores, dashes, this kind of things), you are welcome to omit the quotes. The strings for which quotes are not mandatory are called NCNames. This class of strings can be used for unquoted keys, for variable and function names, and for module aliases.
		</div><div class="example"><a id="idm140319566711856"></a><p class="title"><strong>Example 5.16. Object constructors with unquoted key 1</strong></p><div class="example-contents"><pre class="programlisting">
{ foo : "bar" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566714720"></a><p class="title"><strong>Example 5.17. Object constructors with unquoted key 2</strong></p><div class="example-contents"><pre class="programlisting">
{ foo : [ 1, 2, 3, 4, 5, 6 ] }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : [ 1, 2, 3, 4, 5, 6 ] }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566717616"></a><p class="title"><strong>Example 5.18. Object constructors with unquoted key 3</strong></p><div class="example-contents"><pre class="programlisting">
{ foo : "bar", bar : "foo" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar", "bar" : "foo" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319561943680"></a><p class="title"><strong>Example 5.19. Object constructors with needed quotes around the key</strong></p><div class="example-contents"><pre class="programlisting">
{ "but you need the quotes here" : null }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "but you need the quotes here" : null }
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319561946896"></a>5.1.3. Array constructors</h3></div></div></div><div class="figure"><a id="idm140319561947536"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ArrayConstructor.png" alt="ArrayConstructor" /></div></div><p class="title"><strong>Figure 5.11. ArrayConstructor</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319566631616"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Expr.png" alt="Expr" /></div></div><p class="title"><strong>Figure 5.12. Expr</strong></p></div><br class="figure-break" /><div class="para">
			The syntax for creating arrays is identical to that of JSON: square brackets, comma separated literals, object constructors and arrays constructors.
		</div><div class="example"><a id="idm140319566637232"></a><p class="title"><strong>Example 5.20. Empty array constructors</strong></p><div class="example-contents"><pre class="programlisting">
[]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ ]
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319516356752"></a><p class="title"><strong>Example 5.21. Array constructors</strong></p><div class="example-contents"><pre class="programlisting">
[ 1, 2, 3, 4, 5, 6 ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ 1, 2, 3, 4, 5, 6 ]
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319516359664"></a><p class="title"><strong>Example 5.22. Nested array constructors</strong></p><div class="example-contents"><pre class="programlisting">
[ "foo", 3.14, [ "Go", "Boldly", "When", "No", "Man", "Has", "Gone", "Before" ], { "foo" : "bar" }, true, false, null ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ "foo", 3.14, [ "Go", "Boldly", "When", "No", "Man", "Has", "Gone", "Before" ], { "foo" : "bar" }, true, false, null ]
				</div></div></div><br class="example-break" /><div class="para">
			Square brackets are mandatory. Do not push it.
		</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319516360464"></a>5.1.4. Composing constructors</h3></div></div></div><div class="para">
			Of course, JSONiq would not be very interesting if all you could do is copy and paste JSON documents.
		</div><div class="para">
			Because JSONiq expressions are fully composable, in objects and arrays constructors, you can put way more than just atomic literals, object constructors and array constructors: you can put any JSONiq expression.
		</div><div class="para">
			The following examples are just a few of many operators you can use: "to" for creating arithmetic sequences, "||" for concatenating strings, "+" for adding numbers, "," for appending sequences.
		</div><div class="para">
			In an array, the operand expression will evaluated to a sequence of items, and these items will be copied and become members of the newly created array.
		</div><div class="example"><a id="idm140319567063024"></a><p class="title"><strong>Example 5.23. Composable array constructors</strong></p><div class="example-contents"><pre class="programlisting">
  [ 1 to 10 ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ]
				</div></div></div><br class="example-break" /><div class="para">
			In an object, the expression you use for the key must evaluate to an atomic - if it is not a string, it will just be cast to it.
		</div><div class="example"><a id="idm140319521848400"></a><p class="title"><strong>Example 5.24. Composable object keys</strong></p><div class="example-contents"><pre class="programlisting">
  { "foo" || "bar" : true }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foobar" : true }
				</div></div></div><br class="example-break" /><div class="para">
			An error is raised if the key expressions is not an atomic.
		</div><div class="example"><a id="idm140319558340432"></a><p class="title"><strong>Example 5.25. Non-atomic object keys</strong></p><div class="example-contents"><pre class="programlisting">
  { [ 1, 2 ] : true }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: can not atomize an array item: an array has probably been passed where an atomic value is expected (e.g., as a key, or to a function expecting an atomic item)
				</div></div></div><br class="example-break" /><div class="para">
			And do not worry about the value expression: if it is is empty, null will be used as a value, and if it contains two items or more, they will be wrapped into an array.
		</div><div class="para">
			If the colon is preceded with a question mark, then the pair will be omitted if the value expression evaluates to the empty sequence.
		</div><div class="example"><a id="idm140319525744416"></a><p class="title"><strong>Example 5.26. Composable object values</strong></p><div class="example-contents"><pre class="programlisting">
  { "foo" : 1 + 1 }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : 2 }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319521394400"></a><p class="title"><strong>Example 5.27. Composable object values and automatic conversion</strong></p><div class="example-contents"><pre class="programlisting">
  { "foo" : (), "bar" : (1, 2) }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : null, "bar" : [ 1, 2 ] }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319557262560"></a><p class="title"><strong>Example 5.28. Optional pair (not implemented yet in Zorba)</strong></p><div class="example-contents"><pre class="programlisting">
  { "foo" ?: (), "bar" : (1, 2) }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: invalid expression: syntax error, unexpected "?", expecting "end of file" or "," or "}"
				</div></div></div><br class="example-break" /><div class="para">
			The {| |} syntax can be used to merge several objects.
		</div><div class="example"><a id="idm140319514521056"></a><p class="title"><strong>Example 5.29. Merging object constructor</strong></p><div class="example-contents"><pre class="programlisting">
  {| { "foo" : "bar" }, { "bar" : "foo" } |}
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar", "bar" : "foo" }
				</div></div></div><br class="example-break" /><div class="para">
			An error is raised if the operand expression does not evaluate to a sequence of objects.
		</div><div class="example"><a id="idm140319526946528"></a><p class="title"><strong>Example 5.30. Merging object constructor with a type error</strong></p><div class="example-contents"><pre class="programlisting">
  {| 1 |}
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: xs:integer can not be treated as type object()*
				</div></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="chapter-basic-operations"></a>5.2. Basic operations</h2></div></div></div><div class="para">
		We now introduce the most basic operations you can perform in JSONiq.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319526655920"></a>5.2.1. Construction of sequences</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm140319517750816"></a>5.2.1.1. Comma operator</h4></div></div></div><div class="figure"><a id="idm140319517648128"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Expr.png" alt="Expr" /></div></div><p class="title"><strong>Figure 5.13. Expr</strong></p></div><br class="figure-break" /><div class="para">
				Use a comma to concatenate two sequences, or even single items. This operator has the lowest precedence of all.
			</div><div class="example"><a id="idm140319531212256"></a><p class="title"><strong>Example 5.31. Comma</strong></p><div class="example-contents"><pre class="programlisting">
1, 2, 3, 4, 5, 6, 7, 8, 9, 10
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						1 2 3 4 5 6 7 8 9 10
					</div></div></div><br class="example-break" /><div class="example"><a id="idm140319514928864"></a><p class="title"><strong>Example 5.32. Comma</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : "bar" }, [ 1 ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						{ "foo" : "bar" } [ 1 ]
					</div></div></div><br class="example-break" /><div class="para">
				Sequences do not nest. You need to use arrays in order to nest.
			</div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idm140319517691280"></a>5.2.1.2. Range operator</h4></div></div></div><div class="figure"><a id="idm140319569297104"></a><div class="figure-contents"><div class="mediaobject"><img src="images/RangeExpr.png" alt="RangeExpr" /></div></div><p class="title"><strong>Figure 5.14. RangeExpr</strong></p></div><br class="figure-break" /><div class="para">
				With the binary operator "to", you can generate larger sequences with just two integer operands.
			</div><div class="example"><a id="idm140319517612976"></a><p class="title"><strong>Example 5.33. Range operator</strong></p><div class="example-contents"><pre class="programlisting">
1 to 10
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						1 2 3 4 5 6 7 8 9 10
					</div></div></div><br class="example-break" /><div class="para">
				If one operand evaluates to the empty sequence, then the range operator returns the empty sequence.
			</div><div class="example"><a id="idm140319561093024"></a><p class="title"><strong>Example 5.34. Range operator with the empty sequence</strong></p><div class="example-contents"><pre class="programlisting">
() to 10, 1 to ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					</div></div></div><br class="example-break" /><div class="para">
				Otherwise, if an operand evaluates to something else than a single integer or an empty sequence, an error is raised.
			</div><div class="example"><a id="idm140319523557296"></a><p class="title"><strong>Example 5.35. Range operator with a type inconsistency</strong></p><div class="example-contents"><pre class="programlisting">
(1, 2) to 10
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						An error was raised: sequence of more than one item can not be promoted to parameter type xs:integer? of function to()
					</div></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319523355840"></a>5.2.2. Parenthesized expression</h3></div></div></div><div class="figure"><a id="idm140319566070432"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ParenthesizedExpr.png" alt="ParenthesizedExpr" /></div></div><p class="title"><strong>Figure 5.15. ParenthesizedExpr</strong></p></div><br class="figure-break" /><div class="para">
			Use parentheses to override the precedence of expressions.
		</div><div class="para">
			If the parentheses are empty, the empty sequence is produced.
		</div><div class="example"><a id="idm140319568779200"></a><p class="title"><strong>Example 5.36. Empty sequence</strong></p><div class="example-contents"><pre class="programlisting">
()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319566044464"></a>5.2.3. Arithmetics</h3></div></div></div><div class="figure"><a id="idm140319558545344"></a><div class="figure-contents"><div class="mediaobject"><img src="images/AdditiveExpr.png" alt="AdditiveExpr" /></div></div><p class="title"><strong>Figure 5.16. AdditiveExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319521854688"></a><div class="figure-contents"><div class="mediaobject"><img src="images/MultiplicativeExpr.png" alt="MultiplicativeExpr" /></div></div><p class="title"><strong>Figure 5.17. MultiplicativeExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319517751408"></a><div class="figure-contents"><div class="mediaobject"><img src="images/UnaryExpr.png" alt="UnaryExpr" /></div></div><p class="title"><strong>Figure 5.18. UnaryExpr</strong></p></div><br class="figure-break" /><div class="para">
			JSONiq supports the basic four operations, integer division and modulo.
		</div><div class="para">
			Multiplicative operations have precedence over additive operations. Parentheses can override it.
		</div><div class="example"><a id="idm140319569262192"></a><p class="title"><strong>Example 5.37. Basic arithmetic operations with precedence override</strong></p><div class="example-contents"><pre class="programlisting">
1 * ( 2 + 3 ) + 7 idiv 2 - (-8) mod 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					8
				</div></div></div><br class="example-break" /><div class="para">
			Dates, times and durations are also supported in a natural way.
		</div><div class="example"><a id="idm140319570895488"></a><p class="title"><strong>Example 5.38. Using basic operations with dates.</strong></p><div class="example-contents"><pre class="programlisting">
date("2013-05-01") - date("2013-04-02")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					P29D
				</div></div></div><br class="example-break" /><div class="para">
			If any of the operands is a sequence of more than one item, an error is raised.
		</div><div class="example"><a id="idm140319568807600"></a><p class="title"><strong>Example 5.39. Sequence of more than one number in an addition</strong></p><div class="example-contents"><pre class="programlisting">
(1, 2) + 3
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: sequence of more than one item can not be promoted to parameter type xs:anyAtomicType? of function add()
				</div></div></div><br class="example-break" /><div class="para">
			If any of the operands is not a number, a date, a time or a duration, an error is raised.
		</div><div class="example"><a id="idm140319517573360"></a><p class="title"><strong>Example 5.40. Null in an addition</strong></p><div class="example-contents"><pre class="programlisting">
1 + null
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: arithmetic operation not defined between types "xs:integer" and "js:null"
				</div></div></div><br class="example-break" /><div class="para">
			If one of the operands evaluates to the empty sequence, then the operation results in the empty sequence.
		</div><div class="para">
			Do not worry if the two operands do not have the same number type, JSONiq will do the adequate conversions.
		</div><div class="example"><a id="idm140319531211744"></a><p class="title"><strong>Example 5.41. Basic arithmetic operations with an empty sequence</strong></p><div class="example-contents"><pre class="programlisting">
() + 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319558533104"></a>5.2.4. String concatenation</h3></div></div></div><div class="figure"><a id="idm140319558705984"></a><div class="figure-contents"><div class="mediaobject"><img src="images/StringConcatExpr.png" alt="StringConcatExpr" /></div></div><p class="title"><strong>Figure 5.19. StringConcatExpr</strong></p></div><br class="figure-break" /><div class="para">
			Two strings or more can be concatenated using the concatenation operator.
		</div><div class="example"><a id="idm140319567081504"></a><p class="title"><strong>Example 5.42. String concatenation</strong></p><div class="example-contents"><pre class="programlisting">
"Captain" || " " || "Kirk"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					Captain Kirk
				</div></div></div><br class="example-break" /><div class="para">
			An empty sequence is treated like an empty string.
		</div><div class="example"><a id="idm140319563011312"></a><p class="title"><strong>Example 5.43. String concatenation with the empty sequence</strong></p><div class="example-contents"><pre class="programlisting">
"Captain" || () || "Kirk"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					CaptainKirk
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319558334752"></a>5.2.5. Comparison</h3></div></div></div><div class="figure"><a id="idm140319562976096"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ComparisonExpr.png" alt="ComparisonExpr" /></div></div><p class="title"><strong>Figure 5.20. ComparisonExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319567431104"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ValueComp.png" alt="ValueComp" /></div></div><p class="title"><strong>Figure 5.21. ValueComp</strong></p></div><br class="figure-break" /><div class="para">
			Atomics can be compared with the usual six comparison operators (equality, non-equality, lower-than, greater-than, lower-or-equal, greater-or-equal), and with the same two-letter symbols as in MongoDB.
		</div><div class="example"><a id="idm140319515319472"></a><p class="title"><strong>Example 5.44. Equality comparison</strong></p><div class="example-contents"><pre class="programlisting">
1 + 1 eq 2, 1 lt 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true true
				</div></div></div><br class="example-break" /><div class="para">
			Comparison is only possible between two compatible types, otherwise, an error is raised.
		</div><div class="example"><a id="idm140319566822416"></a><p class="title"><strong>Example 5.45. Comparisons with a type mismatch</strong></p><div class="example-contents"><pre class="programlisting">
"foo" eq 1
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: "xs:string": invalid type: can not compare for equality to type "xs:integer"
				</div></div></div><br class="example-break" /><div class="para">
			null can be compared for equality or inequality to anything - it is only equal to itself so that false is returned when comparing if for equality with any non-null atomic. True is returned when comparing it with non-equality with any non-null atomic.
		</div><div class="example"><a id="idm140319563999600"></a><p class="title"><strong>Example 5.46. Equality and non-equality comparison with null</strong></p><div class="example-contents"><pre class="programlisting">
1 eq null, "foo" ne null, null eq null
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false true true
				</div></div></div><br class="example-break" /><div class="para">
			For ordering operators (lt, le, gt, ge), null is considered the smallest possible value (like in JavaScript).
		</div><div class="example"><a id="idm140319531196304"></a><p class="title"><strong>Example 5.47. Ordering comparison with null</strong></p><div class="example-contents"><pre class="programlisting">
1 lt null
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="para">
			Like for arithmetic operations, if an operand is the empty sequence, the empty sequence is returned as well.
		</div><div class="example"><a id="idm140319558165856"></a><p class="title"><strong>Example 5.48. Comparison with the empty sequence</strong></p><div class="example-contents"><pre class="programlisting">
() eq 1
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /><div class="para">
			Comparisons and logic operators are fundamental for a query language and for the implementation of a query processor as they impact query optimization greatly. The current comparison semantics for them is carefully chosen to have the right characteristics as to enable optimization.
		</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319515318448"></a>5.2.6. Logics</h3></div></div></div><div class="figure"><a id="idm140319561094880"></a><div class="figure-contents"><div class="mediaobject"><img src="images/OrExpr.png" alt="OrExpr" /></div></div><p class="title"><strong>Figure 5.22. OrExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319515388672"></a><div class="figure-contents"><div class="mediaobject"><img src="images/AndExpr.png" alt="AndExpr" /></div></div><p class="title"><strong>Figure 5.23. AndExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319566291216"></a><div class="figure-contents"><div class="mediaobject"><img src="images/NotExpr.png" alt="NotExpr" /></div></div><p class="title"><strong>Figure 5.24. NotExpr</strong></p></div><br class="figure-break" /><div class="para">
			JSONiq logics support is based on two-valued logics: just true and false.
		</div><div class="para">
			Non-boolean operands get automatically converted to either true or false, or an error is raised. The boolean() function performs a manual conversion.
		</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					An empty sequence is converted to false.
				</div></li><li class="listitem"><div class="para">
					A singleton sequence of one null is converted to false.
				</div></li><li class="listitem"><div class="para">
					A singleton sequence of one string is converted to true except the empty string which is converted to false.
				</div></li><li class="listitem"><div class="para">
					A singleton sequence of one number is converted to true except zero or NaN which are converted to false.
				</div></li><li class="listitem"><div class="para">
					An operand singleton sequence whose first item is an object or array is converted to true.
				</div></li><li class="listitem"><div class="para">
					Other operand sequences cannot be converted and an error is raised.
				</div></li></ul></div><div class="para">
			JSONiq supports the most famous three boolean operations: conjunction, disjunction and negation. Negation has the highest precedence, then conjunction, then disjunction. Parentheses can override.
		</div><div class="example"><a id="idm140319523356464"></a><p class="title"><strong>Example 5.49. Logics with booleans</strong></p><div class="example-contents"><pre class="programlisting">
true and ( true or not true )
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319561054624"></a><p class="title"><strong>Example 5.50. Logics with comparing operands</strong></p><div class="example-contents"><pre class="programlisting">
1 + 1 eq 2 or 1 + 1 eq 3
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319523311232"></a><p class="title"><strong>Example 5.51. Conversion of the empty sequence to false</strong></p><div class="example-contents"><pre class="programlisting">
boolean(())
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571787632"></a><p class="title"><strong>Example 5.52. Conversion of null to false</strong></p><div class="example-contents"><pre class="programlisting">
boolean(null)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571815344"></a><p class="title"><strong>Example 5.53. Conversion of a string to true</strong></p><div class="example-contents"><pre class="programlisting">
boolean("foo"), boolean("")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566614528"></a><p class="title"><strong>Example 5.54. Conversion of a number to false</strong></p><div class="example-contents"><pre class="programlisting">
0 and true, not (not 1e42)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319517649488"></a><p class="title"><strong>Example 5.55. Conversion of an object to a boolean (not implemented in Zorba at this point)</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : "bar" } or false
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="para">
			If the input sequence has more than one item, and the first item is not an object or array, an error is raised.
		</div><div class="example"><a id="idm140319517613840"></a><p class="title"><strong>Example 5.56. Error upon conversion of a sequence of more than one item, not beginning with a JSON item, to a boolean</strong></p><div class="example-contents"><pre class="programlisting">
( 1, 2, 3 ) or false
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: invalid argument type for function fn:boolean(): effective boolean value not defined for sequence of more than one item that starts with "xs:integer"
				</div></div></div><br class="example-break" /><div class="para">
			Unlike in C++ or Java, you cannot rely on the order of evaluation of the operands of a boolean operation. The following query may return true or may return an error.
		</div><div class="example"><a id="idm140319510931376"></a><p class="title"><strong>Example 5.57. Non-determinism in presence of errors.</strong></p><div class="example-contents"><pre class="programlisting">
true or (1 div 0)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="figure"><a id="idm140319531230464"></a><div class="figure-contents"><div class="mediaobject"><img src="images/QuantifiedExpr.png" alt="QuantifiedExpr" /></div></div><p class="title"><strong>Figure 5.25. QuantifiedExpr</strong></p></div><br class="figure-break" /><div class="para">
			It is possible to perform a conjunction or a disjunction on a predicate for each item in a sequence.
		</div><div class="example"><a id="idm140319533787856"></a><p class="title"><strong>Example 5.58. Universal quantifier</strong></p><div class="example-contents"><pre class="programlisting">
every $i in 1 to 10 satisfies $i gt 0
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319558714688"></a><p class="title"><strong>Example 5.59. Existential quantifier on several variables</strong></p><div class="example-contents"><pre class="programlisting">
some $i in -5 to 5, $j in 1 to 10 satisfies $i eq $j
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="para">
			Variables can be annotated with a type. If no type is specified, item* is assumed. If the type does not match, an error is raised.
		</div><div class="example"><a id="idm140319573014048"></a><p class="title"><strong>Example 5.60. Existential quantifier with type checking</strong></p><div class="example-contents"><pre class="programlisting">
some $i as integer in -5 to 5, $j as integer in 1 to 10 satisfies $i eq $j
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="chapter-function-calls"></a>5.3. Function Calls</h2></div></div></div><div class="figure"><a id="idm140319510901104"></a><div class="figure-contents"><div class="mediaobject"><img src="images/FunctionCall.png" alt="FunctionCall" /></div></div><p class="title"><strong>Figure 5.26. FunctionCall</strong></p></div><br class="figure-break" /><div class="para">
		The syntax for function calls is similar to many other languages. JSONiq supports three sorts of functions:
	</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
				Builtin functions: these have no prefix and can be called without any import.
			</div></li><li class="listitem"><div class="para">
				Local functions: they are defined in the prolog, to be used in the main query. They have the prefix <span class="emphasis"><em>local:</em></span>. Chapter <a class="xref" href="#chapter-prolog">Chapter 6, <em>Prologs</em></a> describes how to define your own local functions.
			</div></li><li class="listitem"><div class="para">
				Imported functions: they are defined in a library module. They have the prefix corresponding to the alias to which the imported module has been bound to. Chapter <a class="xref" href="#chapter-modules">Chapter 7, <em>Modules</em></a> describes how to define your own modules.
			</div></li></ul></div><div class="example"><a id="idm140319532058064"></a><p class="title"><strong>Example 5.61. A builtin function call.</strong></p><div class="example-contents"><pre class="programlisting">
     keys({ "foo" : "bar", "bar" : "foo" })
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				foo bar
			</div></div></div><br class="example-break" /><div class="example"><a id="idm140319525076688"></a><p class="title"><strong>Example 5.62. A builtin function call.</strong></p><div class="example-contents"><pre class="programlisting">
     concat("foo", "bar")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				foobar
			</div></div></div><br class="example-break" /><div class="para">
		An error is raised if the actual types do not match the expected types.
	</div><div class="example"><a id="idm140319517718144"></a><p class="title"><strong>Example 5.63. A type error in a function call.</strong></p><div class="example-contents"><pre class="programlisting">
     sum({ "foo" : "bar" })
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				An error was raised: can not atomize an object item: an object has probably been passed where an atomic value is expected (e.g., as a key, or to a function expecting an atomic item)
			</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="chapter-selectors"></a>5.4. Selectors</h2></div></div></div><div class="figure"><a id="idm140319565288256"></a><div class="figure-contents"><div class="mediaobject"><img src="images/PostfixExpr.png" alt="PostfixExpr" /></div></div><p class="title"><strong>Figure 5.27. PostfixExpr</strong></p></div><br class="figure-break" /><div class="para">
		Like in JavaScript, it is possible to navigate through data.
	</div><div class="para">
		JSONiq supports filtering items from a sequence, looking up the value associated with a given key in an object, looking up the item at a given position in an array, and looking up all items in an array.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319530191904"></a>5.4.1. Object field selector</h3></div></div></div><div class="figure"><a id="idm140319533847472"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ObjectLookup.png" alt="ObjectLookup" /></div></div><p class="title"><strong>Figure 5.28. ObjectLookup</strong></p></div><br class="figure-break" /><div class="para">
			The simplest way to navigate in an object is similar to JavaScript, using a dot. This will work as soon as you do not push it too much: alphanumerical characters, dashes, underscores - just like unquoted keys in object constructors, any NCName is allowed.
		</div><div class="example"><a id="idm140319558280512"></a><p class="title"><strong>Example 5.64. Object lookup</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : "bar" }.foo
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="para">
			Since JSONiq expressions are composable, you can also use any expression for the left-hand side. You might need parentheses depending on the precedence.
		</div><div class="example"><a id="idm140319566670928"></a><p class="title"><strong>Example 5.65. Lookup on a single-object collection.</strong></p><div class="example-contents"><pre class="programlisting">
collection("one-object").foo
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="para">
			The dot operator does an implicit mapping on the left-hand-side, i.e., it applies the lookup in turn on each item. Lookup on an object returns the value associated with the supplied key, or the empty sequence if there is none. Lookup on any item which is not an object (arrays and atomics) results in the empty sequence.
		</div><div class="example"><a id="idm140319579761728"></a><p class="title"><strong>Example 5.66. Object lookup with an iteration on several objects</strong></p><div class="example-contents"><pre class="programlisting">
({ "foo" : "bar" }, { "foo" : "bar2" }, { "bar" : "foo" }).foo
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar bar2
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319532117424"></a><p class="title"><strong>Example 5.67. Object lookup with an iteration on a collection</strong></p><div class="example-contents"><pre class="programlisting">
collection("captains").name
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					James T. Kirk Jean-Luc Picard Benjamin Sisko Kathryn Janeway Jonathan Archer Samantha Carter
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571889520"></a><p class="title"><strong>Example 5.68. Object lookup on a mixed sequence</strong></p><div class="example-contents"><pre class="programlisting">
({ "foo" : "bar1" }, [ "foo", "bar" ], { "foo" : "bar2" }, "foo").foo
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar1 bar2
				</div></div></div><br class="example-break" /><div class="para">
			Of course, unquoted keys will not work for strings that are not NCNames, e.g., if the field contains a dot or begins with a digit. Then you will need quotes.
		</div><div class="example"><a id="idm140319525048800"></a><p class="title"><strong>Example 5.69. Quotes for object lookup</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo bar" : "bar" }."foo bar"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="para">
			If you use an expression on the right side of the dot, it must always have parentheses. The result of the right-hand-side expression is cast to a string. An error is raised if the cast fails.
		</div><div class="example"><a id="idm140319579699776"></a><p class="title"><strong>Example 5.70. Object lookup with a nested expression</strong></p><div class="example-contents"><pre class="programlisting">
{ "foobar" : "bar" }.("foo" || "bar")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319579757408"></a><p class="title"><strong>Example 5.71. Object lookup with a nested expression</strong></p><div class="example-contents"><pre class="programlisting">
{ "foobar" : "bar" }.("foo", "bar")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: sequence of more than one item can not be treated as type xs:string
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566865232"></a><p class="title"><strong>Example 5.72. Object lookup with a nested expression</strong></p><div class="example-contents"><pre class="programlisting">
{ "1" : "bar" }.(1)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="para">
			Variables, or a context item reference, do not need parentheses. Variables are introduced later, but here is a sneak peek:
		</div><div class="example"><a id="idm140319533878944"></a><p class="title"><strong>Example 5.73. Object lookup with a variable</strong></p><div class="example-contents"><pre class="programlisting">
let $field := "foo" || "bar"
return { "foobar" : "bar" }.$field
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319516341920"></a>5.4.2. Array member selector</h3></div></div></div><div class="figure"><a id="idm140319516341120"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ArrayLookup.png" alt="ArrayLookup" /></div></div><p class="title"><strong>Figure 5.29. ArrayLookup</strong></p></div><br class="figure-break" /><div class="para">
			Array lookup uses double square brackets.
		</div><div class="example"><a id="idm140319563015776"></a><p class="title"><strong>Example 5.74. Array lookup</strong></p><div class="example-contents"><pre class="programlisting">
[ "foo", "bar" ] [[2]]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="para">
			Since JSONiq expressions are composable, you can also use any expression for the left-hand side. You might need parentheses depending on the precedence.
		</div><div class="example"><a id="idm140319558408272"></a><p class="title"><strong>Example 5.75. Array lookup after an object lookup</strong></p><div class="example-contents"><pre class="programlisting">
{ field : [ "one",  { "foo" : "bar" } ] }.field[[2]].foo
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="para">
			The array lookup operator does an implicit mapping on the left-hand-side, i.e., it applies the lookup in turn on each item. Lookup on an array returns the item at that position in the array, or the empty sequence if there is none (position larger than size or smaller than 1). Lookup on any item which is not an array (objects and atomics) results in the empty sequence.
		</div><div class="example"><a id="idm140319561260768"></a><p class="title"><strong>Example 5.76. Array lookup with an iteration on several arrays</strong></p><div class="example-contents"><pre class="programlisting">
([ 1, 2, 3 ], [ 4, 5, 6 ])[[2]]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2 5
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319557652624"></a><p class="title"><strong>Example 5.77. Array lookup with an iteration on a collection</strong></p><div class="example-contents"><pre class="programlisting">
collection("captains").series[[1]]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					The original series The next generation The next generation The next generation Entreprise Voyager
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319568672192"></a><p class="title"><strong>Example 5.78. Array lookup on a mixed sequence</strong></p><div class="example-contents"><pre class="programlisting">
([ 1, 2, 3 ], [ 4, 5, 6 ], { "foo" : "bar" }, true)[[3]]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					3 6
				</div></div></div><br class="example-break" /><div class="para">
			The expression inside the double-square brackets may be any expression. The result of evaluating this expression is cast to an integer. An error is raised if the cast fails.
		</div><div class="example"><a id="idm140319572666000"></a><p class="title"><strong>Example 5.79. Array lookup with a right-hand-side expression</strong></p><div class="example-contents"><pre class="programlisting">
[ "foo", "bar" ] [[ 1 + 1 ]]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="figure"><a id="idm140319579759088"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ArrayUnboxing.png" alt="ArrayUnboxing" /></div></div><p class="title"><strong>Figure 5.30. ArrayUnboxing</strong></p></div><br class="figure-break" /><div class="para">
			You can also extract all items from an array (i.e., as a sequence) with the [] syntax. The [] operator also implicitly iterates on the left-hand-side, returning the empty sequence for non-arrays.
		</div><div class="example"><a id="idm140319523818704"></a><p class="title"><strong>Example 5.80. Extracting all items from an array</strong></p><div class="example-contents"><pre class="programlisting">
[ "foo", "bar" ][]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo bar
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571789248"></a><p class="title"><strong>Example 5.81. Extracting all items from arrays in a mixed sequence</strong></p><div class="example-contents"><pre class="programlisting">
([ "foo", "bar" ], { "foo" : "bar" }, true, [ 1, 2, 3 ] )[]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo bar 1 2 3
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319517629088"></a>5.4.3. Sequence predicates</h3></div></div></div><div class="figure"><a id="idm140319517628288"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Predicate.png" alt="Predicate" /></div></div><p class="title"><strong>Figure 5.31. Predicate</strong></p></div><br class="figure-break" /><div class="para">
			A predicate allows filtering a sequence, keeping only items that fulfill it.
		</div><div class="para">
			The predicate is evaluated once for each item in the left-hand-side sequence, with the context item set to that item. The predicate expression can use $$ to access this context item.
		</div><div class="figure"><a id="idm140319568712368"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ContextItemExpr.png" alt="ContextItemExpr" /></div></div><p class="title"><strong>Figure 5.32. ContextItemExpr</strong></p></div><br class="figure-break" /><div class="para">
			If the predicate evaluates to an integer, it is matched against the item position in the left-hand side sequence automatically
		</div><div class="example"><a id="idm140319514379600"></a><p class="title"><strong>Example 5.82. Predicate expression</strong></p><div class="example-contents"><pre class="programlisting">
(1 to 10)[2]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2
				</div></div></div><br class="example-break" /><div class="para">
			Otherwise, the result of the predicate is converted to a boolean.
		</div><div class="para">
			All items for which the converted predicate result evaluates to true are then output.
		</div><div class="example"><a id="idm140319517673424"></a><p class="title"><strong>Example 5.83. Predicate expression</strong></p><div class="example-contents"><pre class="programlisting">
(1 to 10)[$$ mod 2 eq 0]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2 4 6 8 10
				</div></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="chapter-control-flow"></a>5.5. Control flow expressions</h2></div></div></div><div class="para">
		JSONiq supports control flow expressions such as if-then-else, switch and typeswitch.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319561116016"></a>5.5.1. Conditional expressions</h3></div></div></div><div class="figure"><a id="idm140319561115216"></a><div class="figure-contents"><div class="mediaobject"><img src="images/IfExpr.png" alt="IfExpr" /></div></div><p class="title"><strong>Figure 5.33. IfExpr</strong></p></div><br class="figure-break" /><div class="para">
			A conditional expressions allows you to pick one or another value depending on a boolean value.
		</div><div class="example"><a id="idm140319576052832"></a><p class="title"><strong>Example 5.84. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if (1 + 1 eq 2) then { "foo" : "yes" } else { "foo" : "false" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "yes" }
				</div></div></div><br class="example-break" /><div class="para">
			The behavior of the expression inside the if is similar to that of logical operations (two-valued logics), meaning that non-boolean values get converted to a boolean.
		</div><div class="example"><a id="idm140319563013552"></a><p class="title"><strong>Example 5.85. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if (null) then { "foo" : "yes" } else { "foo" : "no" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "no" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319533799600"></a><p class="title"><strong>Example 5.86. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if (1) then { "foo" : "yes" } else { "foo" : "no" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "yes" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319525046416"></a><p class="title"><strong>Example 5.87. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if (0) then { "foo" : "yes" } else { "foo" : "no" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "no" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319567447712"></a><p class="title"><strong>Example 5.88. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if ("foo") then { "foo" : "yes" } else { "foo" : "no" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "yes" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566314384"></a><p class="title"><strong>Example 5.89. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if ("") then { "foo" : "yes" } else { "foo" : "no" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "no" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319581225616"></a><p class="title"><strong>Example 5.90. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if (()) then { "foo" : "yes" } else { "foo" : "no" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "no" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319514928304"></a><p class="title"><strong>Example 5.91. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if (({ "foo" : "bar" }, [ 1, 2, 3, 4])) then { "foo" : "yes" } else { "foo" : "no" }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "yes" }
				</div></div></div><br class="example-break" /><div class="para">
			Note that the else clause is mandatory (but can be the empty sequence)
		</div><div class="example"><a id="idm140319569298080"></a><p class="title"><strong>Example 5.92. A conditional expression</strong></p><div class="example-contents"><pre class="programlisting">
if (1+1 eq 2) then { "foo" : "yes" } else ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "yes" }
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319570202912"></a>5.5.2. Switch expressions</h3></div></div></div><div class="figure"><a id="idm140319570202112"></a><div class="figure-contents"><div class="mediaobject"><img src="images/SwitchExpr.png" alt="SwitchExpr" /></div></div><p class="title"><strong>Figure 5.34. SwitchExpr</strong></p></div><br class="figure-break" /><div class="para">
			A switch expression evaluates the expression inside the switch. If it is an atomic, it compares it in turn to the provided atomic values (with the semantics of the eq operator) and returns the value associated with the first matching case clause.
		</div><div class="example"><a id="idm140319566501280"></a><p class="title"><strong>Example 5.93. A switch expression</strong></p><div class="example-contents"><pre class="programlisting">
switch ("foo")
case "bar" return "foo"
case "foo" return "bar"
default return "none"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					bar
				</div></div></div><br class="example-break" /><div class="para">
			If it is not an atomic, an error is raised.
		</div><div class="example"><a id="idm140319561027536"></a><p class="title"><strong>Example 5.94. A switch expression</strong></p><div class="example-contents"><pre class="programlisting">
switch ({ "foo" : "bar" })
case "bar" return "foo"
case "foo" return "bar"
default return "none"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: can not atomize an object item: an object has probably been passed where an atomic value is expected (e.g., as a key, or to a function expecting an atomic item)
				</div></div></div><br class="example-break" /><div class="para">
			If no value matches, the default is used.
		</div><div class="example"><a id="idm140319531641376"></a><p class="title"><strong>Example 5.95. A switch expression</strong></p><div class="example-contents"><pre class="programlisting">
switch ("no-match")
case "bar" return "foo"
case "foo" return "bar"
default return "none"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					none
				</div></div></div><br class="example-break" /><div class="para">
			The case clauses support composability of expressions as well.
		</div><div class="example"><a id="idm140319533865392"></a><p class="title"><strong>Example 5.96. A switch expression</strong></p><div class="example-contents"><pre class="programlisting">
switch (2)
case 1 + 1 return "foo"
case 2 + 2 return "bar"
default return "none"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319515338432"></a><p class="title"><strong>Example 5.97. A switch expression</strong></p><div class="example-contents"><pre class="programlisting">
switch (true)
case 1 + 1 eq 2 return "1 + 1 is 2"
case 2 + 2 eq 5 return "2 + 2 is 5"
default return "none of the above is true"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1 + 1 is 2
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319576130064"></a>5.5.3. Try-catch expressions</h3></div></div></div><div class="figure"><a id="idm140319576129264"></a><div class="figure-contents"><div class="mediaobject"><img src="images/TryCatchExpr.png" alt="TryCatchExpr" /></div></div><p class="title"><strong>Figure 5.35. TryCatchExpr</strong></p></div><br class="figure-break" /><div class="para">
			A try catch expression evaluates the expression inside the try block and returns its resulting value.
		</div><div class="para">
			However, if an error is raised dynamically, the catch clause is evaluated and its result value returned.
		</div><div class="example"><a id="idm140319566854656"></a><p class="title"><strong>Example 5.98. A try catch expression</strong></p><div class="example-contents"><pre class="programlisting">
try { 1 div 0 } catch * { "division by zero!" } 
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					division by zero!
				</div></div></div><br class="example-break" /><div class="para">
			Only errors raised within the lexical scope of the try block are caught.
		</div><div class="example"><a id="idm140319557761440"></a><p class="title"><strong>Example 5.99. A try catch expression</strong></p><div class="example-contents"><pre class="programlisting">
let $x := 1 div 0
return try { $x }
       catch * { "division by zero!" } 
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: division by zero
				</div></div></div><br class="example-break" /><div class="para">
			Errors that are detected statically within the try block are still reported statically.
		</div><div class="example"><a id="idm140319561030208"></a><p class="title"><strong>Example 5.100. A try catch expression</strong></p><div class="example-contents"><pre class="programlisting">
try { x } catch * { "syntax error" } 
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					syntax error
				</div></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="chapter-flwor"></a>5.6. FLWOR expressions</h2></div></div></div><div class="figure"><a id="idm140319515353776"></a><div class="figure-contents"><div class="mediaobject"><img src="images/FLWORExpr.png" alt="FLWORExpr" /></div></div><p class="title"><strong>Figure 5.36. FLWORExpr</strong></p></div><br class="figure-break" /><div class="para">
		FLWOR expressions are probably the most powerful JSONiq construct and correspond to SQL's SELECT-FROM-WHERE statements, but they are more general and more flexible. In particular, clauses can almost appear in any order (apart that it must begin with a for or let clause, and end with a return clause).
	</div><div class="para">
		Here is a bit of theory on how it works.
	</div><div class="para">
		A clause binds values to some variables according to its own semantics, possibly several times. Each time, a tuple of variable bindings (mapping variable names to sequences) is passed on to the next clause.
	</div><div class="para">
		This goes all the way down, until the return clause. The return clause is eventually evaluated for each tuple of variable bindings, resulting in a sequence of items for each tuple.
	</div><div class="para">
		These sequences of items are concatenated, in the order of the incoming tuples, and the obtained sequence is returned by the FLWOR expression.
	</div><div class="para">
		We are now giving practical examples with a hint on how it maps to SQL.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319581287120"></a>5.6.1. For clauses</h3></div></div></div><div class="figure"><a id="idm140319581286320"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ForClause.png" alt="ForClause" /></div></div><p class="title"><strong>Figure 5.37. ForClause</strong></p></div><br class="figure-break" /><div class="para">
			For clauses allow iteration on a sequence.
		</div><div class="para">
			For each incoming tuple, the expression in the for clause is evaluated to a sequence. Each item in this sequence is in turn bound to the for variable. A tuple is hence produced for each incoming tuple, and for each item in the sequence produced by the for clause for this tuple.
		</div><div class="para">
			The order in which items are bound by the for clause can be relaxed with unordered expressions, as described later in this section.
		</div><div class="para">
			The following query, using a for and a return clause, is the counterpart of SQL's "SELECT name FROM captains". $x is bound in turn to each item in the captains collection.
		</div><div class="example"><a id="idm140319569276672"></a><p class="title"><strong>Example 5.101. A for clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
return $x.name
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					James T. Kirk Jean-Luc Picard Benjamin Sisko Kathryn Janeway Jonathan Archer Samantha Carter
				</div></div></div><br class="example-break" /><div class="para">
			For clause expressions are composable, there can be several of them.
		</div><div class="example"><a id="idm140319533813376"></a><p class="title"><strong>Example 5.102. Two for clauses.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in ( 1, 2, 3 )
for $y in ( 1, 2, 3 )
return 10 * $x + $y
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					11 12 13 21 22 23 31 32 33
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319577346560"></a><p class="title"><strong>Example 5.103. A for clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in ( 1, 2, 3 ), $y in ( 1, 2, 3 )
return 10 * $x + $y
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					11 12 13 21 22 23 31 32 33
				</div></div></div><br class="example-break" /><div class="para">
			A for variable is visible to subsequence bindings.
		</div><div class="example"><a id="idm140319570912624"></a><p class="title"><strong>Example 5.104. A for clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in ( [ 1, 2, 3 ], [ 4, 5, 6 ], [ 7, 8, 9 ] ), $y in $x[]
return $y
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1 2 3 4 5 6 7 8 9
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319531246640"></a><p class="title"><strong>Example 5.105. A for clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains"), $y in $x.series[]
return { "captain" : $x.name, "series" : $y }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "captain" : "James T. Kirk", "series" : "The original series" } { "captain" : "Jean-Luc Picard", "series" : "The next generation" } { "captain" : "Benjamin Sisko", "series" : "The next generation" } { "captain" : "Benjamin Sisko", "series" : "Deep Space 9" } { "captain" : "Kathryn Janeway", "series" : "The next generation" } { "captain" : "Kathryn Janeway", "series" : "Voyager" } { "captain" : "Jonathan Archer", "series" : "Entreprise" } { "captain" : null, "series" : "Voyager" }
				</div></div></div><br class="example-break" /><div class="para">
			It is also possible to bind the position of the current item in the sequence to a variable.
		</div><div class="example"><a id="idm140319527033376"></a><p class="title"><strong>Example 5.106. A for clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x at $position in collection("captains")
return { "captain" : $x.name, "id" : $position }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "captain" : "James T. Kirk", "id" : 1 } { "captain" : "Jean-Luc Picard", "id" : 2 } { "captain" : "Benjamin Sisko", "id" : 3 } { "captain" : "Kathryn Janeway", "id" : 4 } { "captain" : "Jonathan Archer", "id" : 5 } { "captain" : null, "id" : 6 } { "captain" : "Samantha Carter", "id" : 7 }
				</div></div></div><br class="example-break" /><div class="para">
			JSONiq supports joins. For example, the counterpart of "SELECT c.name AS captain, m.name AS movie FROM captains c JOIN movies m ON c.name = m.name" is:
		</div><div class="example"><a id="idm140319566852224"></a><p class="title"><strong>Example 5.107. A join</strong></p><div class="example-contents"><pre class="programlisting">
for $captain in collection("captains"), $movie in collection("movies")[ try { $$.captain eq $captain.name } catch * { false } ]
return { "captain" : $captain.name, "movie" : $movie.name }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "captain" : "James T. Kirk", "movie" : "The Motion Picture" } { "captain" : "James T. Kirk", "movie" : "The Wrath of Kahn" } { "captain" : "James T. Kirk", "movie" : "The Search for Spock" } { "captain" : "James T. Kirk", "movie" : "The Voyage Home" } { "captain" : "James T. Kirk", "movie" : "The Final Frontier" } { "captain" : "James T. Kirk", "movie" : "The Undiscovered Country" } { "captain" : "Jean-Luc Picard", "movie" : "First Contact" } { "captain" : "Jean-Luc Picard", "movie" : "Insurrection" } { "captain" : "Jean-Luc Picard", "movie" : "Nemesis" }
				</div></div></div><br class="example-break" /><div class="para">
			Note how JSONiq handles semi-structured data in a flexible way.
		</div><div class="para">
			Outer joins are also possible with "allowing empty", i.e., output will also be produced if there is no matching movie for a captain. The following query is the counterpart of "SELECT c.name AS captain, m.name AS movie FROM captains c LEFT JOIN movies m ON c.name = m.captain".
		</div><div class="example"><a id="idm140319517567280"></a><p class="title"><strong>Example 5.108. A join</strong></p><div class="example-contents"><pre class="programlisting">
for $captain in collection("captains"), $movie allowing empty in collection("movies")[ try { $$.captain eq $captain.name } catch * { false } ]
return { "captain" : $captain.name, "movie" : $movie.name }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "captain" : "James T. Kirk", "movie" : "The Motion Picture" } { "captain" : "James T. Kirk", "movie" : "The Wrath of Kahn" } { "captain" : "James T. Kirk", "movie" : "The Search for Spock" } { "captain" : "James T. Kirk", "movie" : "The Voyage Home" } { "captain" : "James T. Kirk", "movie" : "The Final Frontier" } { "captain" : "James T. Kirk", "movie" : "The Undiscovered Country" } { "captain" : "Jean-Luc Picard", "movie" : "First Contact" } { "captain" : "Jean-Luc Picard", "movie" : "Insurrection" } { "captain" : "Jean-Luc Picard", "movie" : "Nemesis" } { "captain" : "Benjamin Sisko", "movie" : null } { "captain" : "Kathryn Janeway", "movie" : null } { "captain" : "Jonathan Archer", "movie" : null } { "captain" : null, "movie" : null } { "captain" : "Samantha Carter", "movie" : null }
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319531205952"></a>5.6.2. Where clauses</h3></div></div></div><div class="figure"><a id="idm140319531205152"></a><div class="figure-contents"><div class="mediaobject"><img src="images/WhereClause.png" alt="WhereClause" /></div></div><p class="title"><strong>Figure 5.38. WhereClause</strong></p></div><br class="figure-break" /><div class="para">
			Where clauses are used for filtering (selection operator in the relational algebra).
		</div><div class="para">
			For each incoming tuple, the expression in the where clause is evaluated to a boolean (possibly converting an atomic to a boolean). if this boolean is true, the tuple is forwarded to the next clause, otherwise it is dropped.
		</div><div class="para">
			The following query corresponds to "SELECT series FROM captains WHERE name = 'Kathryn Janeway'".
		</div><div class="example"><a id="idm140319579655184"></a><p class="title"><strong>Example 5.109. A where clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
where $x.name eq "Kathryn Janeway"
return $x.series
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ "The next generation", "Voyager" ]
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319557688352"></a>5.6.3. Order clauses</h3></div></div></div><div class="figure"><a id="idm140319557687552"></a><div class="figure-contents"><div class="mediaobject"><img src="images/OrderByClause.png" alt="OrderByClause" /></div></div><p class="title"><strong>Figure 5.39. OrderByClause</strong></p></div><br class="figure-break" /><div class="para">
			Order clauses are for reordering tuples.
		</div><div class="para">
			For each incoming tuple, the expression in the where clause is evaluated to an atomic. The tuples are then sorted based on the atomics they are associated with, and then forwarded to the next clause.
		</div><div class="para">
			Like for ordering comparisons, null values are always considered the smallest.
		</div><div class="para">
			The following query is the counterpart of SQL's "SELECT * FROM captains ORDER BY name".
		</div><div class="example"><a id="idm140319533822336"></a><p class="title"><strong>Example 5.110. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
order by $x.name
return $x
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "name" : "Benjamin Sisko", "series" : [ "The next generation", "Deep Space 9" ], "century" : 24 } { "name" : "James T. Kirk", "series" : [ "The original series" ], "century" : 23 } { "name" : "Jean-Luc Picard", "series" : [ "The next generation" ], "century" : 24 } { "name" : "Jonathan Archer", "series" : [ "Entreprise" ], "century" : 22 } { "name" : "Kathryn Janeway", "series" : [ "The next generation", "Voyager" ], "century" : 24 } { "name" : "Samantha Carter", "series" : [ ], "century" : 21 } { "codename" : "Emergency Command Hologram", "surname" : "The Doctor", "series" : [ "Voyager" ], "century" : 24 }
				</div></div></div><br class="example-break" /><div class="para">
			Multiple sorting criteria can be given - they are treated like a lexicographic order (most important criterium first).
		</div><div class="example"><a id="idm140319567191968"></a><p class="title"><strong>Example 5.111. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
order by size($x.series), $x.name
return $x
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "name" : "Samantha Carter", "series" : [ ], "century" : 21 } { "name" : "James T. Kirk", "series" : [ "The original series" ], "century" : 23 } { "name" : "Jean-Luc Picard", "series" : [ "The next generation" ], "century" : 24 } { "name" : "Jonathan Archer", "series" : [ "Entreprise" ], "century" : 22 } { "codename" : "Emergency Command Hologram", "surname" : "The Doctor", "series" : [ "Voyager" ], "century" : 24 } { "name" : "Benjamin Sisko", "series" : [ "The next generation", "Deep Space 9" ], "century" : 24 } { "name" : "Kathryn Janeway", "series" : [ "The next generation", "Voyager" ], "century" : 24 }
				</div></div></div><br class="example-break" /><div class="para">
			It can be specified whether the order is ascending or descending. Empty sequences are allowed and it can be chosen whether to put them first or last.
		</div><div class="example"><a id="idm140319558283360"></a><p class="title"><strong>Example 5.112. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
order by $x.name descending empty greatest
return $x
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "codename" : "Emergency Command Hologram", "surname" : "The Doctor", "series" : [ "Voyager" ], "century" : 24 } { "name" : "Samantha Carter", "series" : [ ], "century" : 21 } { "name" : "Kathryn Janeway", "series" : [ "The next generation", "Voyager" ], "century" : 24 } { "name" : "Jonathan Archer", "series" : [ "Entreprise" ], "century" : 22 } { "name" : "Jean-Luc Picard", "series" : [ "The next generation" ], "century" : 24 } { "name" : "James T. Kirk", "series" : [ "The original series" ], "century" : 23 } { "name" : "Benjamin Sisko", "series" : [ "The next generation", "Deep Space 9" ], "century" : 24 }
				</div></div></div><br class="example-break" /><div class="para">
			An error is raised if the expression does not evaluate to an atomic or the empty sequence.
		</div><div class="example"><a id="idm140319569992496"></a><p class="title"><strong>Example 5.113. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
order by $x
return $x.name
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: can not atomize an object item: an object has probably been passed where an atomic value is expected (e.g., as a key, or to a function expecting an atomic item)
				</div></div></div><br class="example-break" /><div class="para">
			Collations can be used to give a specific way of how strings are to be ordered. A collation is identified by a URI.
		</div><div class="example"><a id="idm140319575658528"></a><p class="title"><strong>Example 5.114. Use of a collation in an order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
order by $x.name collation "http://www.w3.org/2005/xpath-functions/collation/codepoint"
return $x.name
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					Benjamin Sisko James T. Kirk Jean-Luc Picard Jonathan Archer Kathryn Janeway Samantha Carter
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319531443008"></a>5.6.4. Group clauses</h3></div></div></div><div class="figure"><a id="idm140319531442208"></a><div class="figure-contents"><div class="mediaobject"><img src="images/GroupByClause.png" alt="GroupByClause" /></div></div><p class="title"><strong>Figure 5.40. GroupByClause</strong></p></div><br class="figure-break" /><div class="para">
			Grouping is also supported, like in SQL.
		</div><div class="para">
			For each incoming tuple, the expression in the group clause is evaluated to an atomic (a grouping key). The incoming tuples are then grouped according to the key they are associated with.
		</div><div class="para">
			For each group, a tuple is output, with a binding from the grouping variable to the key of the group.
		</div><div class="example"><a id="idm140319576044096"></a><p class="title"><strong>Example 5.115. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
group by $century := $x.century
return { "century" : $century  }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "century" : 21 } { "century" : 22 } { "century" : 23 } { "century" : 24 }
				</div></div></div><br class="example-break" /><div class="para">
			As for the other (non-grouping) variables, their values within one group are all concatenated, keeping the same name. Aggregations can be done on these variables.
		</div><div class="para">
			The following query is equivalent to "SELECT century, COUNT(*) FROM captains GROUP BY century".
		</div><div class="example"><a id="idm140319533864864"></a><p class="title"><strong>Example 5.116. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
group by $century := $x.century
return { "century" : $century, "count" : count($x) }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "century" : 21, "count" : 1 } { "century" : 22, "count" : 1 } { "century" : 23, "count" : 1 } { "century" : 24, "count" : 4 }
				</div></div></div><br class="example-break" /><div class="para">
			JSONiq's group by is more flexible than SQL and is fully composable.
		</div><div class="example"><a id="idm140319558148848"></a><p class="title"><strong>Example 5.117. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
group by $century := $x.century
return { "century" : $century, "captains" : [ $x.name ] }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "century" : 21, "captains" : [ "Samantha Carter" ] } { "century" : 22, "captains" : [ "Jonathan Archer" ] } { "century" : 23, "captains" : [ "James T. Kirk" ] } { "century" : 24, "captains" : [ "Jean-Luc Picard", "Benjamin Sisko", "Kathryn Janeway" ] }
				</div></div></div><br class="example-break" /><div class="para">
			Unlike SQL, JSONiq does not need a having clause, because a where clause works perfectly after grouping as well.
		</div><div class="para">
			The following query is the counterpart of "SELECT century, COUNT(*) FROM captains GROUP BY century HAVING COUNT(*) &gt; 1"
		</div><div class="example"><a id="idm140319521795344"></a><p class="title"><strong>Example 5.118. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
group by $century := $x.century
where count($x) gt 1
return { "century" : $century, "count" : count($x) }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "century" : 24, "count" : 4 }
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319572574592"></a>5.6.5. Let clauses</h3></div></div></div><div class="figure"><a id="idm140319572573792"></a><div class="figure-contents"><div class="mediaobject"><img src="images/LetClause.png" alt="LetClause" /></div></div><p class="title"><strong>Figure 5.41. LetClause</strong></p></div><br class="figure-break" /><div class="para">
			Let bindings can be used to define aliases for any sequence, for convenience.
		</div><div class="para">
			For each incoming tuple, the expression in the let clause is evaluated to a sequence. A binding is added from this sequence to the let variable in each tuple. A tuple is hence produced for each incoming tuple.
		</div><div class="example"><a id="idm140319561181264"></a><p class="title"><strong>Example 5.119. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
let $century := $x.century
group by $century
let $number := count($x)
where $number gt 1
return { "century" : $century, "count" : $number }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "century" : 24, "count" : 4 }
				</div></div></div><br class="example-break" /><div class="para">
			Note that it is perfectly fine to reuse a variable name and hide a variable binding.
		</div><div class="example"><a id="idm140319561142512"></a><p class="title"><strong>Example 5.120. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
let $century := $x.century
group by $century
let $number := count($x)
let $number := count(distinct-values(for $series in $x.series
                                     return typeswitch($series)
                                            case array return $series()
                                            default return $series ))
where $number gt 1
return { "century" : $century, "number of series" : $number }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "century" : 24, "number of series" : 3 }
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319558358448"></a>5.6.6. Count clauses</h3></div></div></div><div class="figure"><a id="idm140319558357648"></a><div class="figure-contents"><div class="mediaobject"><img src="images/CountClause.png" alt="CountClause" /></div></div><p class="title"><strong>Figure 5.42. CountClause</strong></p></div><br class="figure-break" /><div class="para">
			For each incoming tuple, a binding from the position of this tuple in the tuple stream to the count variable is added. The new tuple is then forwarded to the next clause.
		</div><div class="example"><a id="idm140319575950560"></a><p class="title"><strong>Example 5.121. An order by clause.</strong></p><div class="example-contents"><pre class="programlisting">
for $x in collection("captains")
order by $x.name
count $c
return { "id" : $c, "captain" : $x }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "id" : 1, "captain" : { "name" : "Benjamin Sisko", "series" : [ "The next generation", "Deep Space 9" ], "century" : 24 } } { "id" : 2, "captain" : { "name" : "James T. Kirk", "series" : [ "The original series" ], "century" : 23 } } { "id" : 3, "captain" : { "name" : "Jean-Luc Picard", "series" : [ "The next generation" ], "century" : 24 } } { "id" : 4, "captain" : { "name" : "Jonathan Archer", "series" : [ "Entreprise" ], "century" : 22 } } { "id" : 5, "captain" : { "name" : "Kathryn Janeway", "series" : [ "The next generation", "Voyager" ], "century" : 24 } } { "id" : 6, "captain" : { "name" : "Samantha Carter", "series" : [ ], "century" : 21 } } { "id" : 7, "captain" : { "codename" : "Emergency Command Hologram", "surname" : "The Doctor", "series" : [ "Voyager" ], "century" : 24 } }
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319558197472"></a>5.6.7. Map operator</h3></div></div></div><div class="figure"><a id="idm140319566910384"></a><div class="figure-contents"><div class="mediaobject"><img src="images/SimpleMapExpr.png" alt="SimpleMapExpr" /></div></div><p class="title"><strong>Figure 5.43. SimpleMapExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319509872736"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ContextItemExpr.png" alt="ContextItemExpr" /></div></div><p class="title"><strong>Figure 5.44. ContextItemExpr</strong></p></div><br class="figure-break" /><div class="para">
			JSONiq provides a shortcut for a for-return construct, automatically binding each item in the left-hand-side sequence to the context item.
		</div><div class="example"><a id="idm140319561227072"></a><p class="title"><strong>Example 5.122. A simple map</strong></p><div class="example-contents"><pre class="programlisting">
(1 to 10) ! ($$ * 2)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2 4 6 8 10 12 14 16 18 20
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319557714032"></a><p class="title"><strong>Example 5.123. An equivalent query</strong></p><div class="example-contents"><pre class="programlisting">
for $i in 1 to 10
return $i * 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2 4 6 8 10 12 14 16 18 20
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319510903872"></a>5.6.8. Composing FLWOR expressions</h3></div></div></div><div class="para">
			Like all other expressions, FLWOR expressions can be composed. In the following examples, a FLWOR is nested in a function call, nested in a FLWOR, nested in an array constructor:
		</div><div class="example"><a id="idm140319573921280"></a><p class="title"><strong>Example 5.124. Nested FLWORs</strong></p><div class="example-contents"><pre class="programlisting">
        [
          for $c in collection("captains")
          where exists(for $m in collection("movies")
                       where some $moviecaptain in let $captain := $m.captain
                                                   return typeswitch ($captain)
                                                          case array return $captain()
                                                          default return $captain
                             satisfies
                             $moviecaptain eq $c.name
                       return $m)
          return $c.name
        ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ "James T. Kirk", "Jean-Luc Picard" ]
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319558698368"></a>5.6.9. Ordered and Unordered expressions</h3></div></div></div><div class="figure"><a id="idm140319558697600"></a><div class="figure-contents"><div class="mediaobject"><img src="images/OrderedExpr.png" alt="OrderedExpr" /></div></div><p class="title"><strong>Figure 5.45. OrderedExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319557727712"></a><div class="figure-contents"><div class="mediaobject"><img src="images/UnorderedExpr.png" alt="UnorderedExpr" /></div></div><p class="title"><strong>Figure 5.46. UnorderedExpr</strong></p></div><br class="figure-break" /><div class="para">
			By default, the order in which a for clause binds its items is important.
		</div><div class="para">
			This behaviour can be relaxed in order give the optimizer more leeway. An unordered expression relaxes ordering by for clauses within its operand scope:
		</div><div class="example"><a id="idm140319568652192"></a><p class="title"><strong>Example 5.125. An unordered expression.</strong></p><div class="example-contents"><pre class="programlisting">
unordered {
  for $captain in collection("captains")
  where $captain.century eq 24
  return $captain
}
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "name" : "Jean-Luc Picard", "series" : [ "The next generation" ], "century" : 24 } { "name" : "Benjamin Sisko", "series" : [ "The next generation", "Deep Space 9" ], "century" : 24 } { "name" : "Kathryn Janeway", "series" : [ "The next generation", "Voyager" ], "century" : 24 } { "codename" : "Emergency Command Hologram", "surname" : "The Doctor", "series" : [ "Voyager" ], "century" : 24 }
				</div></div></div><br class="example-break" /><div class="para">
			An ordered expression can be used to reactivate ordering behaviour in a subscope.
		</div><div class="example"><a id="idm140319523318800"></a><p class="title"><strong>Example 5.126. An ordered expression.</strong></p><div class="example-contents"><pre class="programlisting">
unordered {
  for $captain in collection("captains")
  where ordered { exists(for $movie at $i in collection("movies")
                         where $i eq 5
                         where $movie.captain eq $captain.name
                         return $movie) }
  return $captain
}
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "name" : "James T. Kirk", "series" : [ "The original series" ], "century" : 23 }
				</div></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="section-type-expressions"></a>5.7. Expressions dealing with types</h2></div></div></div><div class="para">
		This section describes JSONiq types as well as the sequence type syntax.
	</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319571340912"></a>5.7.1. Instance-of expressions</h3></div></div></div><div class="figure"><a id="idm140319571340112"></a><div class="figure-contents"><div class="mediaobject"><img src="images/InstanceofExpr.png" alt="InstanceofExpr" /></div></div><p class="title"><strong>Figure 5.47. InstanceofExpr</strong></p></div><br class="figure-break" /><div class="para">
			An instance expression can be used to tell whether a JSONiq value matches a given sequence type.
		</div><div class="example"><a id="idm140319566659072"></a><p class="title"><strong>Example 5.127. Instance of expression</strong></p><div class="example-contents"><pre class="programlisting">
1 instance of integer
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319561026752"></a><p class="title"><strong>Example 5.128. Instance of expression</strong></p><div class="example-contents"><pre class="programlisting">
1 instance of string
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319561178720"></a><p class="title"><strong>Example 5.129. Instance of expression</strong></p><div class="example-contents"><pre class="programlisting">
"foo" instance of string
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566878208"></a><p class="title"><strong>Example 5.130. Instance of expression</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : "bar" } instance of object
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319557668656"></a><p class="title"><strong>Example 5.131. Instance of expression</strong></p><div class="example-contents"><pre class="programlisting">
({ "foo" : "bar" }, { "bar" : "foo" }) instance of json-item+
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319515370320"></a><p class="title"><strong>Example 5.132. Instance of expression</strong></p><div class="example-contents"><pre class="programlisting">
[ 1, 2, 3 ] instance of array?
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319567378848"></a><p class="title"><strong>Example 5.133. Instance of expression</strong></p><div class="example-contents"><pre class="programlisting">
() instance of ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319568782224"></a>5.7.2. Treat expressions</h3></div></div></div><div class="figure"><a id="idm140319568781424"></a><div class="figure-contents"><div class="mediaobject"><img src="images/TreatExpr.png" alt="TreatExpr" /></div></div><p class="title"><strong>Figure 5.48. TreatExpr</strong></p></div><br class="figure-break" /><div class="para">
			A treat expression checks that a JSONiq value matches a given sequence type. If it is not the case, an error is raised.
		</div><div class="example"><a id="idm140319566879840"></a><p class="title"><strong>Example 5.134. Treat as expression</strong></p><div class="example-contents"><pre class="programlisting">
1 treat as integer
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319572633664"></a><p class="title"><strong>Example 5.135. Treat as expression</strong></p><div class="example-contents"><pre class="programlisting">
1 treat as string
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: "xs:integer" cannot be treated as type xs:string
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319576114880"></a><p class="title"><strong>Example 5.136. Treat as expression</strong></p><div class="example-contents"><pre class="programlisting">
"foo" treat as string
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foo
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319569979872"></a><p class="title"><strong>Example 5.137. Treat as expression</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : "bar" } treat as object
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319568814544"></a><p class="title"><strong>Example 5.138. Treat as expression</strong></p><div class="example-contents"><pre class="programlisting">
({ "foo" : "bar" }, { "bar" : "foo" }) treat as json-item+
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar" } { "bar" : "foo" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319568737104"></a><p class="title"><strong>Example 5.139. Treat as expression</strong></p><div class="example-contents"><pre class="programlisting">
[ 1, 2, 3 ] treat as array?
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ 1, 2, 3 ]
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319523376560"></a><p class="title"><strong>Example 5.140. Treat as expression</strong></p><div class="example-contents"><pre class="programlisting">
() treat as ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319558338832"></a>5.7.3. Castable expressions</h3></div></div></div><div class="figure"><a id="idm140319558338032"></a><div class="figure-contents"><div class="mediaobject"><img src="images/CastableExpr.png" alt="CastableExpr" /></div></div><p class="title"><strong>Figure 5.49. CastableExpr</strong></p></div><br class="figure-break" /><div class="para">
			A castable expression checks whether a JSONiq value can be cast to a given atomic type and returns true or false accordingly. It can be used before actually casting to that type.
		</div><div class="example"><a id="idm140319561222768"></a><p class="title"><strong>Example 5.141. Castable as expression</strong></p><div class="example-contents"><pre class="programlisting">
"1" castable as integer
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319579622752"></a><p class="title"><strong>Example 5.142. Castable as expression</strong></p><div class="example-contents"><pre class="programlisting">
"foo" castable as integer
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319579619936"></a><p class="title"><strong>Example 5.143. Castable as expression</strong></p><div class="example-contents"><pre class="programlisting">
"2013-04-02" castable as date
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566276240"></a><p class="title"><strong>Example 5.144. Castable as expression</strong></p><div class="example-contents"><pre class="programlisting">
() castable as date
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319557766992"></a><p class="title"><strong>Example 5.145. Castable as expression</strong></p><div class="example-contents"><pre class="programlisting">
("2013-04-02", "2013-04-03") castable as date
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="para">
			The question mark allows for an empty sequence.
		</div><div class="example"><a id="idm140319566613216"></a><p class="title"><strong>Example 5.146. Castable as expression</strong></p><div class="example-contents"><pre class="programlisting">
() castable as date?
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319567052960"></a>5.7.4. Cast expressions</h3></div></div></div><div class="figure"><a id="idm140319567052160"></a><div class="figure-contents"><div class="mediaobject"><img src="images/CastExpr.png" alt="CastExpr" /></div></div><p class="title"><strong>Figure 5.50. CastExpr</strong></p></div><br class="figure-break" /><div class="para">
			A cast expression casts a JSONiq value to a given atomic type. The resulting value is annotated with this type.
		</div><div class="example"><a id="idm140319532228208"></a><p class="title"><strong>Example 5.147. Cast as expression</strong></p><div class="example-contents"><pre class="programlisting">
"1" cast as integer
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571799568"></a><p class="title"><strong>Example 5.148. Cast as expression</strong></p><div class="example-contents"><pre class="programlisting">
"foo" cast as integer
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: "foo": value of type xs:string is not castable to type xs:integer
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566844512"></a><p class="title"><strong>Example 5.149. Cast as expression</strong></p><div class="example-contents"><pre class="programlisting">
"2013-04-02" cast as date
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2013-04-02
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319510899072"></a><p class="title"><strong>Example 5.150. Cast as expression</strong></p><div class="example-contents"><pre class="programlisting">
() cast as date
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: empty sequence can not be cast to type with quantifier '1'
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319514452528"></a><p class="title"><strong>Example 5.151. Cast as expression</strong></p><div class="example-contents"><pre class="programlisting">
("2013-04-02", "2013-04-03") cast as date
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: sequence of more than one item can not be cast to type with quantifier '1' or '?'
				</div></div></div><br class="example-break" /><div class="para">
			The question mark allows for an empty sequence.
		</div><div class="example"><a id="idm140319570165520"></a><p class="title"><strong>Example 5.152. Cast as expression</strong></p><div class="example-contents"><pre class="programlisting">
() cast as date?
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319567048848"></a><p class="title"><strong>Example 5.153. Cast as expression</strong></p><div class="example-contents"><pre class="programlisting">
"2013-04-02" cast as date?
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2013-04-02
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319567589168"></a>5.7.5. Typeswitch expressions</h3></div></div></div><div class="figure"><a id="idm140319567588368"></a><div class="figure-contents"><div class="mediaobject"><img src="images/TypeswitchExpr.png" alt="TypeswitchExpr" /></div></div><p class="title"><strong>Figure 5.51. TypeswitchExpr</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319568704352"></a><div class="figure-contents"><div class="mediaobject"><img src="images/CaseClause.png" alt="CaseClause" /></div></div><p class="title"><strong>Figure 5.52. CaseClause</strong></p></div><br class="figure-break" /><div class="para">
			A typeswitch expressions tests if the value resulting from the first operand matches a given list of types. The expression corresponding to the first matching case is finally evaluated. If there is no match, the expression in the default clause is evaluated.
		</div><div class="example"><a id="idm140319558450256"></a><p class="title"><strong>Example 5.154. Typeswitch expression</strong></p><div class="example-contents"><pre class="programlisting">
typeswitch("foo")
case integer return "integer"
case string return "string"
case object return "object"
default return "other"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					string
				</div></div></div><br class="example-break" /><div class="para">
			In each clause, it is possible to bind the value of the first operand to a variable.
		</div><div class="example"><a id="idm140319517763472"></a><p class="title"><strong>Example 5.155. Typeswitch expression</strong></p><div class="example-contents"><pre class="programlisting">
typeswitch("foo")
case $i as integer return $i + 1
case $s as string return $s || "foo"
case $o as object return [ $o ]
default $d return $d
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					foofoo
				</div></div></div><br class="example-break" /><div class="para">
			The vertical bar can be used to allow several types in the same case clause.
		</div><div class="example"><a id="idm140319572623328"></a><p class="title"><strong>Example 5.156. Typeswitch expression</strong></p><div class="example-contents"><pre class="programlisting">
typeswitch("foo")
case $a as integer | string return { "integer or string" : $a }
case $o as object return [ $o ]
default $d return $d
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "integer or string" : "foo" }
				</div></div></div><br class="example-break" /></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-prolog"></a>Chapter 6. Prologs</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#idm140319522574800">6.1. Setters.</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319557378272">6.1.1. Default collation</a></span></dt><dt><span class="section"><a href="#idm140319525305456">6.1.2. Default ordering mode</a></span></dt><dt><span class="section"><a href="#idm140319523035840">6.1.3. Default ordering behaviour for empty sequences</a></span></dt><dt><span class="section"><a href="#idm140319531498784">6.1.4. Default decimal format</a></span></dt></dl></dd><dt><span class="section"><a href="#idm140319521861776">6.2. Global variables</a></span></dt><dt><span class="section"><a href="#idm140319531450384">6.3. Functions</a></span></dt></dl></div><div class="para">
		This section introduces prologs, which allows declaring functions and global variables that can then be used in the main query. A prolog also allows setting some default behaviour.
	</div><div class="figure"><a id="idm140319529652080"></a><div class="figure-contents"><div class="mediaobject"><img src="images/MainModule.png" alt="MainModule" /></div></div><p class="title"><strong>Figure 6.1. MainModule</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319523360768"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Prolog.png" alt="Prolog" /></div></div><p class="title"><strong>Figure 6.2. Prolog</strong></p></div><br class="figure-break" /><div class="para">
		The prolog appears before the main query and is optional. It can contain setters and module imports, followed by function and variable declarations.
	</div><div class="para">
		Module imports are explained in the next chapter.
	</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319522574800"></a>6.1. Setters.</h2></div></div></div><div class="figure"><a id="idm140319523658352"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Setter.png" alt="Setter" /></div></div><p class="title"><strong>Figure 6.3. Setter</strong></p></div><br class="figure-break" /><div class="para">
			Setters allow to specify a default behaviour for various aspects of the language.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319557378272"></a>6.1.1. Default collation</h3></div></div></div><div class="figure"><a id="idm140319531363760"></a><div class="figure-contents"><div class="mediaobject"><img src="images/DefaultCollationDecl.png" alt="DefaultCollationDecl" /></div></div><p class="title"><strong>Figure 6.4. DefaultCollationDecl</strong></p></div><br class="figure-break" /><div class="para">
				This specifies the default collation used for grouping and ordering clauses in FLWOR expressions. It can be overriden with a collation directive in these clauses.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319525305456"></a>6.1.2. Default ordering mode</h3></div></div></div><div class="figure"><a id="idm140319566251136"></a><div class="figure-contents"><div class="mediaobject"><img src="images/OrderingModeDecl.png" alt="OrderingModeDecl" /></div></div><p class="title"><strong>Figure 6.5. OrderingModeDecl</strong></p></div><br class="figure-break" /><div class="para">
				This specifies the default behaviour of from clauses, i.e., if they bind tuples in the order in which items occur in the binding sequence. It can be overriden with ordered and unordered expressions.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319523035840"></a>6.1.3. Default ordering behaviour for empty sequences</h3></div></div></div><div class="figure"><a id="idm140319523035072"></a><div class="figure-contents"><div class="mediaobject"><img src="images/EmptyOrderDecl.png" alt="EmptyOrderDecl" /></div></div><p class="title"><strong>Figure 6.6. EmptyOrderDecl</strong></p></div><br class="figure-break" /><div class="para">
				This specifies whether empty sequences come first or last in an ordering clause. It can be overriden by the corresponding directives in such clauses.
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319531498784"></a>6.1.4. Default decimal format</h3></div></div></div><div class="figure"><a id="idm140319531497984"></a><div class="figure-contents"><div class="mediaobject"><img src="images/DecimalFormatDecl.png" alt="DecimalFormatDecl" /></div></div><p class="title"><strong>Figure 6.7. DecimalFormatDecl</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319531495392"></a><div class="figure-contents"><div class="mediaobject"><img src="images/DFPropertyName.png" alt="DFPropertyName" /></div></div><p class="title"><strong>Figure 6.8. DFPropertyName</strong></p></div><br class="figure-break" /><div class="para">
				This specifies a default decimal format for the builtin function format-number().
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319521861776"></a>6.2. Global variables</h2></div></div></div><div class="figure"><a id="idm140319521860976"></a><div class="figure-contents"><div class="mediaobject"><img src="images/VarDecl.png" alt="VarDecl" /></div></div><p class="title"><strong>Figure 6.9. VarDecl</strong></p></div><br class="figure-break" /><div class="para">
			Variables can be declared global. Global variables are declared in the prolog.
		</div><div class="example"><a id="idm140319521857904"></a><p class="title"><strong>Example 6.1. Global variable</strong></p><div class="example-contents"><pre class="programlisting">
  declare variable $obj := { "foo" : "bar" };
  $obj
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319523217152"></a><p class="title"><strong>Example 6.2. Global variable</strong></p><div class="example-contents"><pre class="programlisting">
  declare variable $numbers := (1, 2, 3, 4, 5);
  [ $numbers ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ 1, 2, 3, 4, 5 ]
				</div></div></div><br class="example-break" /><div class="para">
			You can specify a type for a variable. If the type does not match, an error is raised. Types will be explained later. In general, you do not need to worry too much about variable types except if you want to make sure that what you bind to a variable is really what you want. In most cases, the engine will take care of types for you.
		</div><div class="example"><a id="idm140319523213568"></a><p class="title"><strong>Example 6.3. Global variable with a type</strong></p><div class="example-contents"><pre class="programlisting">
  declare variable $obj as object := { "foo" : "bar" };
  $obj
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar" }
				</div></div></div><br class="example-break" /><div class="para">
			An external variable allows you to pass a value from the outside environment, which can be very useful. Each implementation can choose their own way of passing a value to an external variable. A default value for an external variable can also be supplied in case none is provided outside.
		</div><div class="example"><a id="idm140319523210064"></a><p class="title"><strong>Example 6.4. An external global variable</strong></p><div class="example-contents"><pre class="programlisting">
  declare variable $obj external;
  $obj
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: "obj": variable has no value
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319531453296"></a><p class="title"><strong>Example 6.5. An external global variable with a default value</strong></p><div class="example-contents"><pre class="programlisting">
  declare variable $obj external := { "foo" : "bar" };
  $obj
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : "bar" }
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319531450384"></a>6.3. Functions</h2></div></div></div><div class="figure"><a id="idm140319531449584"></a><div class="figure-contents"><div class="mediaobject"><img src="images/FunctionDecl.png" alt="VarDecl" /></div></div><p class="title"><strong>Figure 6.10. VarDecl</strong></p></div><br class="figure-break" /><div class="para">
			You can define your own functions in the prolog. These user-defined functions must be prefixed with <span class="emphasis"><em>local:</em></span>, both in the declaration and when called.
		</div><div class="para">
			Remember than types are optional, and if you do not specify any, item* is assumed, both for parameters and for the return type.
		</div><div class="example"><a id="idm140319531445344"></a><p class="title"><strong>Example 6.6. An external global variable with a default value</strong></p><div class="example-contents"><pre class="programlisting">
declare function local:say-hello($x) { "Hello, " || $x || "!" };
local:say-hello("Mister Spock")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					Hello, Mister Spock!
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319531562848"></a><p class="title"><strong>Example 6.7. An external global variable with a default value</strong></p><div class="example-contents"><pre class="programlisting">
declare function local:say-hello($x as string) { "Hello, " || $x || "!" };
local:say-hello("Mister Spock")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					Hello, Mister Spock!
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319531559968"></a><p class="title"><strong>Example 6.8. An external global variable with a default value</strong></p><div class="example-contents"><pre class="programlisting">
declare function local:say-hello($x as string) as string { "Hello, " || $x || "!" };
local:say-hello("Mister Spock")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					Hello, Mister Spock!
				</div></div></div><br class="example-break" /><div class="para">
			If you do specify types, an error is raised in case of a mismatch
		</div><div class="example"><a id="idm140319531556640"></a><p class="title"><strong>Example 6.9. An external global variable with a default value</strong></p><div class="example-contents"><pre class="programlisting">
declare function local:say-hello($x) { "Hello, " || $x || "!" }; 
local:say-hello(1)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					Hello, 1!
				</div></div></div><br class="example-break" /></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-modules"></a>Chapter 7. Modules</h1></div></div></div><div class="figure"><a id="idm140319530318528"></a><div class="figure-contents"><div class="mediaobject"><img src="images/Module.png" alt="Module" /></div></div><p class="title"><strong>Figure 7.1. Module</strong></p></div><br class="figure-break" /><div class="para">
		You can group functions and variables in separate library modules.
	</div><div class="figure"><a id="idm140319569182976"></a><div class="figure-contents"><div class="mediaobject"><img src="images/MainModule.png" alt="MainModule" /></div></div><p class="title"><strong>Figure 7.2. MainModule</strong></p></div><br class="figure-break" /><div class="para">
		Up to now, everything we encountered were main modules, i.e., a prolog followed by a main query.
	</div><div class="figure"><a id="idm140319586971632"></a><div class="figure-contents"><div class="mediaobject"><img src="images/LibraryModule.png" alt="LibraryModule" /></div></div><p class="title"><strong>Figure 7.3. LibraryModule</strong></p></div><br class="figure-break" /><div class="figure"><a id="idm140319522641904"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ModuleDecl.png" alt="ModuleDecl" /></div></div><p class="title"><strong>Figure 7.4. ModuleDecl</strong></p></div><br class="figure-break" /><div class="para">
		A library module does not contain any query - just functions and variables that can be imported by other modules.
	</div><div class="para">
		A library module must be assigned to a namespace. For convenience, this namespace is bound to an alias in the module declaration. All variables and functions in a library module must be prefixed with this alias.
	</div><div class="example"><a id="idm140319528807296"></a><p class="title"><strong>Example 7.1. A library module</strong></p><div class="example-contents"><pre class="programlisting">
module namespace my = "http://www.example.com/my-module";
declare variable $my:variable := { "foo" : "bar" };
declare variable $my:n := 42;
declare function my:function($i as integer) { $i * $i };
</pre></div></div><br class="example-break" /><div class="figure"><a id="idm140319525872400"></a><div class="figure-contents"><div class="mediaobject"><img src="images/ModuleImport.png" alt="ModuleImport" /></div></div><p class="title"><strong>Figure 7.5. ModuleImport</strong></p></div><br class="figure-break" /><div class="para">
		Here is a main module which imports the former library module. An alias is given to the module namespace (my). Variables and functions from that module can be accessed by prefixing their names with this alias. The alias may be different than the internal alias defined in the imported module.
	</div><div class="example"><a id="idm140319530669120"></a><p class="title"><strong>Example 7.2. An importing main module</strong></p><div class="example-contents"><pre class="programlisting">
import module namespace other= "http://www.example.com/my-module";
other:function($other:n)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				1764
			</div></div></div><br class="example-break" /></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-functions"></a>Chapter 8. Function Library</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#idm140319530076720">8.1. JSON specific functions.</a></span></dt><dd><dl><dt><span class="section"><a href="#idm140319579609680">8.1.1. keys</a></span></dt><dt><span class="section"><a href="#idm140319531592560">8.1.2. members</a></span></dt><dt><span class="section"><a href="#idm140319574095632">8.1.3. null</a></span></dt><dt><span class="section"><a href="#idm140319527785856">8.1.4. parse-json</a></span></dt><dt><span class="section"><a href="#idm140319566787104">8.1.5. size</a></span></dt><dt><span class="section"><a href="#idm140319579649520">8.1.6. accumulate</a></span></dt><dt><span class="section"><a href="#idm140319579647424">8.1.7. descendant-arrays</a></span></dt><dt><span class="section"><a href="#idm140319525340464">8.1.8. descendant-objects</a></span></dt><dt><span class="section"><a href="#idm140319525338352">8.1.9. descendant-pairs</a></span></dt><dt><span class="section"><a href="#idm140319525333328">8.1.10. flatten</a></span></dt><dt><span class="section"><a href="#idm140319511852528">8.1.11. intersect</a></span></dt><dt><span class="section"><a href="#idm140319511850192">8.1.12. project</a></span></dt><dt><span class="section"><a href="#idm140319511841872">8.1.13. remove-keys</a></span></dt><dt><span class="section"><a href="#idm140319517688912">8.1.14. values</a></span></dt><dt><span class="section"><a href="#idm140319517686928">8.1.15. encode-for-roundtrip</a></span></dt><dt><span class="section"><a href="#idm140319517684208">8.1.16. decode-from-roundtrip</a></span></dt></dl></dd><dt><span class="section"><a href="#idm140319517681712">8.2. Functions taken from XQuery</a></span></dt></dl></div><div class="para">
		JSONiq provides a rich set of functions.
	</div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319530076720"></a>8.1. JSON specific functions.</h2></div></div></div><div class="para">
			Some functions are specific to JSON.
		</div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319579609680"></a>8.1.1. keys</h3></div></div></div><div class="para">
				This function returns the distinct keys of all objects in the supplied sequence, in an implementation-dependent order.
			</div><div class="para">
				<code class="code">keys($o as item*) as string*</code>
			</div><div class="example"><a id="idm140319532240848"></a><p class="title"><strong>Example 8.1. Getting all distinct key names in the supplied objects, ignoring non-objects.</strong></p><div class="example-contents"><pre class="programlisting">
let $o := ("foo", [ 1, 2, 3 ], { "a" : 1, "b" : 2 }, { "a" : 3, "c" : 4 })
return keys($o)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						a b c
					</div></div></div><br class="example-break" /><div class="example"><a id="idm140319521612608"></a><p class="title"><strong>Example 8.2. Retrieving all Pairs from an Object:</strong></p><div class="example-contents"><pre class="programlisting">
let $map := { "eyes" : "blue", "hair" : "fuchsia" }
for $key in keys($map)
return { $key : $map.$key }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						{ "eyes" : "blue" } { "hair" : "fuchsia" }
					</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319531592560"></a>8.1.2. members</h3></div></div></div><div class="para">
				This functions returns all members of all arrays of the supplied sequence.
			</div><div class="para">
				<code class="code">members($a as item*) as item*</code>
			</div><div class="example"><a id="idm140319527047248"></a><p class="title"><strong>Example 8.3. Retrieving the members of all supplied arrays, ignoring non-arrays.</strong></p><div class="example-contents"><pre class="programlisting">
let $planets :=  ( "foo", { "foo" : "bar "}, [ "mercury", "venus", "earth", "mars" ], [ 1, 2, 3 ])
return members($planets)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						mercury venus earth mars 1 2 3
					</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319574095632"></a>8.1.3. null</h3></div></div></div><div class="para">
				This function returns the JSON null.
			</div><div class="para">
				<code class="code">null() as null</code>
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319527785856"></a>8.1.4. parse-json</h3></div></div></div><div class="para">
				This function parses its first parameter (a string) as JSON, and returns the resulting sequence of objects and arrays.
			</div><div class="para">
				<code class="code">parse-json($arg as string?) as json-item*</code>
			</div><div class="para">
				<code class="code">parse-json($arg as string?, $options as object) as json-item*</code>
			</div><div class="para">
				The object optionally supplied as the second parameter may contain additional options:
			</div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
						<code class="code">jsoniq-multiple-top-level-items</code> (boolean): indicates whether parsing to zero, or several objects is allowed. An error is raised if this value is false and there is not exactly one object that was parsed.
					</div></li></ul></div><div class="para">
				If parsing is not successful, an error is raised. Parsing is considered in particular to be non-successful if the boolean associated with "jsoniq-multiple-top-level-items" in the additional parameters is false and there is extra content after parsing a single abject or array.
			</div><div class="example"><a id="idm140319566792800"></a><p class="title"><strong>Example 8.4. Parsing a JSON document</strong></p><div class="example-contents"><pre class="programlisting">
parse-json("{ \"foo\" : \"bar\" }", { "jsoniq-multiple-top-level-items" : false })
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						{ "foo" : "bar" }
					</div></div></div><br class="example-break" /><div class="example"><a id="idm140319566790016"></a><p class="title"><strong>Example 8.5. Parsing multiple, whitespace-separated JSON documents</strong></p><div class="example-contents"><pre class="programlisting">
parse-json("{ \"foo\" : \"bar\" } { \"bar\" : \"foo\" }")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						{ "foo" : "bar" } { "bar" : "foo" }
					</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319566787104"></a>8.1.5. size</h3></div></div></div><div class="para">
				This function returns the size of the supplied array, or the empty sequence if the empty sequence is provided.
			</div><div class="para">
				<code class="code">size($a as array?) as integer?</code>
			</div><div class="example"><a id="idm140319579652464"></a><p class="title"><strong>Example 8.6. Retrieving the size of an array</strong></p><div class="example-contents"><pre class="programlisting">
let $a := [1 to 10]
return size($a)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						10
					</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319579649520"></a>8.1.6. accumulate</h3></div></div></div><div class="para">
				This function dynamically builds an object, like the {| |} syntax, except that it does not throw an error upon pair collision. Instead, it accumulates them, wrapping into an array if necessary. Non-objects are ignored.
			</div><pre class="programlisting">
declare function accumulate($seq as item*) as object
{
  {|
    keys($seq) ! { $$ : $seq.$$ }
  |}
};
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319579647424"></a>8.1.7. descendant-arrays</h3></div></div></div><div class="para">
				This function returns all arrays contained within the supplied items, regardless of depth.
			</div><pre class="programlisting">
declare function descendant-arrays($seq as item*) as array*
{
  for $i in $seq
  return typeswitch ($i)
  case array return ($i, descendant-arrays($i[])
  case object return return descendant-arrays(values($i))
  default return ()
};
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319525340464"></a>8.1.8. descendant-objects</h3></div></div></div><div class="para">
				This function returns all objects contained within the supplied items, regardless of depth.
			</div><pre class="programlisting">
declare function descendant-objects($seq as item*) as object*
{
  for $i in $seq
  return typeswitch ($i)
  case object return ($i, descendant-objects(values($i)))
  case array return return descendant-objects($i[])
  default return ()
};
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319525338352"></a>8.1.9. descendant-pairs</h3></div></div></div><div class="para">
				This function returns all descendant pairs within the supplied items.
			</div><pre class="programlisting">
declare function descendant-pairs($seq as item*)
{
  for $i in $seq
  return typeswitch ($i)
  case object return
    for $k in keys($o)
    let $v := $o.$k
    return ({ $k : $v }, descendant-pairs($v))
  case array return descendant-pairs($i[])
  default return ()
};
</pre><div class="example"><a id="idm140319525336368"></a><p class="title"><strong>Example 8.7. Accessing all descendant pairs</strong></p><div class="example-contents"><pre class="programlisting">
let $o := 
{
  "first" : 1,
  "second" : { 
    "first" : "a", 
    "second" : "b" 
  }
}
return descendant-pairs($o)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						An error was raised: "descendant-pairs": function with arity 1 not declared
					</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319525333328"></a>8.1.10. flatten</h3></div></div></div><div class="para">
				This function recursively flattens arrays in the input sequence, leaving non-arrays intact.
			</div><pre class="programlisting">
declare function flatten($seq as item*) as item*
{
  for $value in $seq
  return typeswitch ($value)
         case array return flatten($value[])
         default return $value
};
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319511852528"></a>8.1.11. intersect</h3></div></div></div><div class="para">
				This function returns the intersection of the supplied objects, and aggregates values corresponding to the same name into an array. Non-objects are ignored.
			</div><pre class="programlisting">
declare function intersect($seq as item*)
{
  {|
    let $objects := $seq[. instance of object()]
    for $key in keys(head($objects))
    where every $object in tail($objects)
          satisfies exists(index-of(keys($object), $key))
    return { $key : $objects.$key }
  |}
};
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319511850192"></a>8.1.12. project</h3></div></div></div><div class="para">
				This function iterates on the input sequence. It projects objects by filtering their pairs and leaves non-objects intact.
			</div><pre class="programlisting">
declare function project($seq as item*, $keys as string*) as item*
{
  for $item in $seq
  return typeswitch ($item)
         case $object as object return
         {|
           for $key in keys($object)
           where some $to-project in $keys satisfies $to-project eq $key
           let $value := $object.$key
           return { $key : $value }
         |}
         default return $item
};
</pre><div class="example"><a id="idm140319511847936"></a><p class="title"><strong>Example 8.8. Projecting an object 1</strong></p><div class="example-contents"><pre class="programlisting">
let $o := {
  "Captain" : "Kirk",
  "First Officer" : "Spock",
  "Engineer" : "Scott"
  }
return project($o, ("Captain", "First Officer"))
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						{ "Captain" : "Kirk", "First Officer" : "Spock" }
					</div></div></div><br class="example-break" /><div class="example"><a id="idm140319511844992"></a><p class="title"><strong>Example 8.9. Projecting an object 2</strong></p><div class="example-contents"><pre class="programlisting">
let $o := {
  "Captain" : "Kirk",
  "First Officer" : "Spock",
  "Engineer" : "Scott"
  }
return project($o, "XQuery Evangelist")
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						{ }
					</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319511841872"></a>8.1.13. remove-keys</h3></div></div></div><div class="para">
				This function iterates on the input sequence. It removes the pairs with the given keys from all objects and leaves non-objects intact.
			</div><pre class="programlisting">
declare function remove-keys($seq as item*, $keys as string*) as item*
{
  for $item in $seq
  return typeswitch ($item)
         case $object as object return
         {|
           for $key in keys($object)
           where every $to-remove in $keys satisfies $to-remove ne $key
           let $value := $object.$key
           return { $key : $value }
         |}
         default return $item
};
</pre><div class="example"><a id="idm140319511839600"></a><p class="title"><strong>Example 8.10. Removing keys from an object (not implemented yet)</strong></p><div class="example-contents"><pre class="programlisting">
let $o := {
  "Captain" : "Kirk",
  "First Officer" : "Spock",
  "Engineer" : "Scott"
  }
return remove-keys($o, ("Captain", "First Officer"))
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
						An error was raised: "remove-keys": function with arity 2 not declared
					</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319517688912"></a>8.1.14. values</h3></div></div></div><div class="para">
				This function returns all values in the supplied objects. Non-objects are ignored.
			</div><pre class="programlisting">
declare function values($seq as item*) as item* {
  for $i in $seq
  for $k in jn:keys($i)
  return $i($k)
};
</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319517686928"></a>8.1.15. encode-for-roundtrip</h3></div></div></div><div class="para">
				This function encodes any sequence of items, even containing non-JSON types, to a sequence of JSON items that can be serialized as pure JSON, in a way that it can be parsed and decoded back using decode-from-roundtrip. JSON features are left intact, while atomic items annotated with a non-JSON type are converted to objects embedding all necessary information.
			</div><div class="para">
				<code class="code">encode-for-roundtrip($items as item*) as json-item*</code>
			</div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idm140319517684208"></a>8.1.16. decode-from-roundtrip</h3></div></div></div><div class="para">
				This function decodes a sequence previously encoded with encode-for-roundtrip.
			</div><div class="para">
				<code class="code">decode-from-roundtrip($items as json-item*) as item*</code>
			</div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319517681712"></a>8.2. Functions taken from XQuery</h2></div></div></div><div class="itemizedlist"><ul><li class="listitem"><div class="para">
					Access to the external environment: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#collection-1">collection#1</a>
				</div></li><li class="listitem"><div class="para">
					Function to turn atomics into booleans for use in two-valued logics: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#boolean-1">boolean#1</a>
				</div></li><li class="listitem"><div class="para">
					Raising errors: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#error-0">error#0</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#error-1">error#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#error-2">error#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#error-3">error#3</a>.
				</div></li><li class="listitem"><div class="para">
					Functions on numeric values: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#abs-1">abs#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#ceilingabs-1">ceilingabs#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#floorabs-1">floorabs#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#roundabs-1">roundabs#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#round-half-to-even-1">round-half-to-even#1</a>
				</div></li><li class="listitem"><div class="para">
					Parsing numbers: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#number-0">number#0</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#number-1">number#1</a>
				</div></li><li class="listitem"><div class="para">
					Formatting integers: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#format-integer-2">format-integer#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#format-integer-3">format-integer#3</a>
				</div></li><li class="listitem"><div class="para">
					Formatting numbers: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#format-number-2">format-number#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#format-number-3">format-number#3</a>
				</div></li><li class="listitem"><div class="para">
					Trigonometric and exponential functions: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#pi-0">pi#0</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#exp-1">exp#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#exp10-1">exp10#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#log-1">log#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#log10-1">log10#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#pow-2">pow#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#sqrt-1">sqrt#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#sin-1">sin#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#cos-1">cos#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#tan-1">tan#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#asin-1">asin#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#acos-1">acos#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#atan-1">atan#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#atan2-1">atan2#1</a>
				</div></li><li class="listitem"><div class="para">
					Functions to assemble and disassemble strings: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#codepoints-to-string-1">codepoints-to-string#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#string-to-codepoints-1">string-to-codepoints#1</a>
				</div></li><li class="listitem"><div class="para">
					Comparison of strings: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#compare-2">compare#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#compare-3">compare#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#codepoint-equal-2">codepoint-equal#2</a>
				</div></li><li class="listitem"><div class="para">
					Functions on string values: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#concat-2">concat#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#string-join-1">string-join#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#string-join-2">string-join#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#substring-2">substring#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#substring-3">substring#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#string-length-0">string-length#0</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#string-length-1">string-length#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#normalize-space-0">normalize-space#0</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#normalize-space-1">normalize-space#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#normalize-unicode-1">normalize-unicode#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#normalize-unicode-2">normalize-unicode#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#upper-case-1">upper-case#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#lower-case-1">lower-case#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#translate-3">translate#3</a>
				</div></li><li class="listitem"><div class="para">
					Functions based on substring matching: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#contains-2">contains#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#contains-3">contains#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#starts-with-2">starts-with#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#starts-with-3">starts-with#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#ends-with-2">ends-with#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#ends-with-3">ends-with#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#substring-before-2">substring-before#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#substring-before-3">substring-before#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#substring-after-2">substring-after#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#substring-after-3">substring-after#3</a>
				</div></li><li class="listitem"><div class="para">
					String functions that use regular expressions: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#matches-2">matches#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#matches-3">matches#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#replace-3">replace#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#replace-4">replace#4</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#tokenize-2">tokenize#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#tokenize-3">tokenize#3</a>
				</div></li><li class="listitem"><div class="para">
					Functions that manipulate URIs: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#resolve-uri-1">resolve-uri#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#resolve-uri-2">resolve-uri#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#encode-for-uri-1">encode-for-uri#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#iri-to-uri-1">iri-to-uri#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#escape-html-uri-1">escape-html-uri#1</a>
				</div></li><li class="listitem"><div class="para">
					General functions on sequences: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#empty-1">empty#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#exists-1">exists#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#head-1">head#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#tail-1">tail#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#insert-before-3">insert-before#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#remove-2">remove#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#reverse-1">reverse#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#subsequence-2">subsequence#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#subsequence-3">subsequence#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#unordered-1">unordered#1</a>
				</div></li><li class="listitem"><div class="para">
					Function that compare values in sequences: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#distinct-values-1">distinct-values#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#distinct-values-2">distinct-values#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#index-of-2">index-of#2</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#index-of-3">index-of#3</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#deep-equal-2">deep-equal#2</a>. <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#deep-equal-3">deep-equal#3</a>
				</div></li><li class="listitem"><div class="para">
					Functions that test the cardinality of sequences: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#zero-or-one-1">zero-or-one#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#one-or-more-1">one-or-more#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#exactly-one-1">exactly-one#1</a>
				</div></li><li class="listitem"><div class="para">
					Aggregate functions: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#count-1">count#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#avg-1">avg#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#max-1">max#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#min-1">min#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#sum-1">sum#1</a>
				</div></li><li class="listitem"><div class="para">
					Serializing functions: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#serialize-1">serialize#1</a> (unary)
				</div></li><li class="listitem"><div class="para">
					Context information: <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#current-dateTime-1">current-dateTime#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#current-date-1">current-date#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#current-time-1">current-time#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#implicit-timezone-1">implicit-timezone#1</a>, <a href="http://www.zorba-xquery.com/html/modules/w3c/xpath#default-collation-1">default-collation#1</a>
				</div></li><li class="listitem"><div class="para">
					Constructor functions: for all builtin types, with the name of the builtin type and unary. Equivalent to a cast expression.
				</div></li></ul></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-equality-and-identity"></a>Chapter 9. Equality and identity</h1></div></div></div><div class="para">
		As in most language, one can distinguish between physical equality and logical equality.
	</div><div class="para">
		Atomics can only be compared logically. Their physically identity is totally opaque to you.
	</div><div class="example"><a id="idm140319523914672"></a><p class="title"><strong>Example 9.1. Logical comparison of two atomics</strong></p><div class="example-contents"><pre class="programlisting">
1 eq 1
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				true
			</div></div></div><br class="example-break" /><div class="example"><a id="idm140319522731664"></a><p class="title"><strong>Example 9.2. Logical comparison of two atomics</strong></p><div class="example-contents"><pre class="programlisting">
1 eq 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				false
			</div></div></div><br class="example-break" /><div class="example"><a id="idm140319515810640"></a><p class="title"><strong>Example 9.3. Logical comparison of two atomics</strong></p><div class="example-contents"><pre class="programlisting">
"foo" eq "bar"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				false
			</div></div></div><br class="example-break" /><div class="example"><a id="idm140319525217968"></a><p class="title"><strong>Example 9.4. Logical comparison of two atomics</strong></p><div class="example-contents"><pre class="programlisting">
"foo" ne "bar"
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				true
			</div></div></div><br class="example-break" /><div class="para">
		Two objects or arrays can be tested for logical equality as well, using deep-equal(), which performs a recursive comparison.
	</div><div class="example"><a id="idm140319515347136"></a><p class="title"><strong>Example 9.5. Logical comparison of two JSON items</strong></p><div class="example-contents"><pre class="programlisting">
deep-equal({ "foo" : "bar" }, { "foo" : "bar" })
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				true
			</div></div></div><br class="example-break" /><div class="example"><a id="idm140319515836640"></a><p class="title"><strong>Example 9.6. Logical comparison of two JSON items</strong></p><div class="example-contents"><pre class="programlisting">
deep-equal({ "foo" : "bar" }, { "bar" : "foo" })
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				false
			</div></div></div><br class="example-break" /><div class="para">
		The physical identity of objects and arrays is not exposed to the user in the core JSONiq language itself. Some library modules might be able to reveal it, though.
	</div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-areas-of-confusion"></a>Chapter 10. Notes</h1></div></div></div><div class="toc"><dl class="toc"><dt><span class="section"><a href="#idm140319528191744">10.1. Sequences vs. Arrays</a></span></dt><dt><span class="section"><a href="#idm140319527541408">10.2. Null vs. empty sequence</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319528191744"></a>10.1. Sequences vs. Arrays</h2></div></div></div><div class="para">
			Even though JSON supports arrays, JSONiq uses a different construct as its first class citizens: sequences. Any value returned by or passed to an expression is a sequence.
		</div><div class="para">
			The main difference between sequences and arrays is that sequences are completely flat, meaning they cannot contain other sequences.
		</div><div class="para">
			Since sequences are flat, expressions of the JSONiq language just concatenate them to form bigger sequences.
		</div><div class="para">
			This is crucial to allow streaming results, for example through an HTTP session.
		</div><div class="example"><a id="idm140319523363664"></a><p class="title"><strong>Example 10.1. Flat sequences</strong></p><div class="example-contents"><pre class="programlisting">
( (1, 2), (3, 4) )
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1 2 3 4
				</div></div></div><br class="example-break" /><div class="para">
			Arrays on the other side can contain nested arrays, like in JSON.
		</div><div class="example"><a id="idm140319558566608"></a><p class="title"><strong>Example 10.2. Nesting arrays</strong></p><div class="example-contents"><pre class="programlisting">
[ [ 1, 2 ], [ 3, 4 ] ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ [ 1, 2 ], [ 3, 4 ] ]
				</div></div></div><br class="example-break" /><div class="para">
			Many expressions return single items - actually, they really return a singleton sequence, but a singleton sequence of one item is considered the same as this item.
		</div><div class="example"><a id="idm140319533804208"></a><p class="title"><strong>Example 10.3. Singleton sequences</strong></p><div class="example-contents"><pre class="programlisting">
1 + 1
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					2
				</div></div></div><br class="example-break" /><div class="para">
			This is different for arrays: a singleton array is distinct from its unique member, like in JSON.
		</div><div class="example"><a id="idm140319558599504"></a><p class="title"><strong>Example 10.4. Singleton sequences</strong></p><div class="example-contents"><pre class="programlisting">
[ 1 + 1 ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ 2 ]
				</div></div></div><br class="example-break" /><div class="para">
			An array is a single item. A (non-singleton) sequence is not. This can be observed by counting the number of items in a sequence.
		</div><div class="example"><a id="idm140319527360064"></a><p class="title"><strong>Example 10.5. count() on an array</strong></p><div class="example-contents"><pre class="programlisting">
count([ 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } ])
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319531015472"></a><p class="title"><strong>Example 10.6. count() on a sequence</strong></p><div class="example-contents"><pre class="programlisting">
count( ( 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } ) )
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					4
				</div></div></div><br class="example-break" /><div class="para">
			Other than that, arrays and sequences can contain exactly the same members (atomics, arrays, objects).
		</div><div class="example"><a id="idm140319521554368"></a><p class="title"><strong>Example 10.7. Members of an array</strong></p><div class="example-contents"><pre class="programlisting">
[ 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } ]
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319521551584"></a><p class="title"><strong>Example 10.8. Members of an sequence</strong></p><div class="example-contents"><pre class="programlisting">
( 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } )
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1 foo [ 1, 2, 3, 4 ] { "foo" : "bar" }
				</div></div></div><br class="example-break" /><div class="para">
			Arrays can be converted to sequences, and vice-versa.
		</div><div class="example"><a id="idm140319527547072"></a><p class="title"><strong>Example 10.9. Converting an array to a sequence</strong></p><div class="example-contents"><pre class="programlisting">
[ 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } ] []
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					1 foo [ 1, 2, 3, 4 ] { "foo" : "bar" }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319527544320"></a><p class="title"><strong>Example 10.10. Converting a sequence to an array</strong></p><div class="example-contents"><pre class="programlisting">
[ ( 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } ) ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ 1, "foo", [ 1, 2, 3, 4 ], { "foo" : "bar" } ]
				</div></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title"><a id="idm140319527541408"></a>10.2. Null vs. empty sequence</h2></div></div></div><div class="para">
			Null and the empty sequence are two different concepts.
		</div><div class="para">
			Null is an item (an atomic value), and can be a member of an array or of a sequence, or the value associated with a key in an object. Sequences cannot, as they represent the absence of any item.
		</div><div class="example"><a id="idm140319527539488"></a><p class="title"><strong>Example 10.11. Null values in an array</strong></p><div class="example-contents"><pre class="programlisting">
[ null, 1, null, 2 ]
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					[ null, 1, null, 2 ]
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319529702928"></a><p class="title"><strong>Example 10.12. Null values in an object</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : null }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : null }
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319529700144"></a><p class="title"><strong>Example 10.13. Null values in a sequence</strong></p><div class="example-contents"><pre class="programlisting">
(null, 1, null, 2)
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					null 1 null 2
				</div></div></div><br class="example-break" /><div class="para">
			If an empty sequence is found as an object value, it is automatically converted to null.
		</div><div class="example"><a id="idm140319567179776"></a><p class="title"><strong>Example 10.14. Automatic conversion to null.</strong></p><div class="example-contents"><pre class="programlisting">
{ "foo" : () }
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					{ "foo" : null }
				</div></div></div><br class="example-break" /><div class="para">
			In an arithmetic opration or a comparison, if an operand is an empty sequence, an empty sequence is returned. If an operand is a null, an error is raised except for equality and inequality.
		</div><div class="example"><a id="idm140319567176336"></a><p class="title"><strong>Example 10.15. Empty sequence in an arithmetic operation.</strong></p><div class="example-contents"><pre class="programlisting">
() + 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319567173520"></a><p class="title"><strong>Example 10.16. Null in an arithmetic operation.</strong></p><div class="example-contents"><pre class="programlisting">
null + 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					An error was raised: arithmetic operation not defined between types "js:null" and "xs:integer"
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319567170608"></a><p class="title"><strong>Example 10.17. Null and empty sequence in an arithmetic operation.</strong></p><div class="example-contents"><pre class="programlisting">
null + ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319567167792"></a><p class="title"><strong>Example 10.18. Empty sequence in a comparison.</strong></p><div class="example-contents"><pre class="programlisting">
() eq 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571009312"></a><p class="title"><strong>Example 10.19. Null in a comparison.</strong></p><div class="example-contents"><pre class="programlisting">
null eq 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					false
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571006464"></a><p class="title"><strong>Example 10.20. Null in a comparison.</strong></p><div class="example-contents"><pre class="programlisting">
null lt 2
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
					true
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571003616"></a><p class="title"><strong>Example 10.21. Null and the empty sequence in a comparison.</strong></p><div class="example-contents"><pre class="programlisting">
null eq ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /><div class="example"><a id="idm140319571000800"></a><p class="title"><strong>Example 10.22. Null and the empty sequence in a comparison.</strong></p><div class="example-contents"><pre class="programlisting">
null lt ()
</pre><div class="formalpara"><div class="title">Result (run with Zorba):</div>
				</div></div></div><br class="example-break" /></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="chapter-open-issues"></a>Chapter 11. Open Issues</h1></div></div></div><div class="para">
		The <a href="http://jsoniq.org/docs/JSONiqExtensionToXQuery/html/section-json-updates.html">JSON update syntax</a> was not integrated yet into the core language. This is planned, and the syntax will be simplified (no json keyword, dot lookup allowed here as well).
	</div><div class="para">
		The semantics for the <a href="http://jsoniq.org/docs/JSONiqExtensionToXQuery/html/section-json-serialization.html">JSON serialization method</a> is the same as in the JSONiq Extension to XQuery. It is still under discussion how to escape special characters with the Text output method.
	</div></div><div class="appendix"><div class="titlepage"><div><div><h1 class="title"><a id="appe-JSONiq-Revision_History"></a>Revision History</h1></div></div></div><div class="para"><p></p>
		<div class="revhistory"><table summary="Revision History"><tr><th align="left" valign="top" colspan="3"><strong>Revision History</strong></th></tr><tr><td align="left">Revision 1-12</td><td align="left">Triday Aug 7th, 2015</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td> Added ?: syntax. </td></tr></table>

				</td></tr><tr><td align="left">Revision 1-11</td><td align="left">Tuesday Aug 13th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td> Refactored definition of parse-json to make options clear. </td></tr><tr><td> Fixed signature of size() to return "integer?". </td></tr><tr><td> Fixed signature of descendant-arrays() to return "array*". </td></tr></table>

				</td></tr><tr><td align="left">Revision 1-10</td><td align="left">Thursday Aug 8th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td> Fixed semantics of libjn:project() to make it consistent with the other functions. </td></tr><tr><td> Added libjn:remove-keys() which does the contrary of libjn:project(), i.e., removes the given keys from all input objects. </td></tr></table>

				</td></tr><tr><td align="left">Revision 1-9</td><td align="left">Monday July 22th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td> Relaxed the functions descendant-objects, descendant-pairs, values, flatten, project to accept any sequence of items. The behavior on mixed sequences is consistent with object and array lookup. Also introduced new function descendant-arrays and relaxed size to accept the empty sequence. </td></tr><tr><td> Relaxed boolean value of sequences beginning with an object or array to be true. </td></tr></table>

				</td></tr><tr><td align="left">Revision 1-8</td><td align="left">Tuesday June 18th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>New array navigation syntax to avoid overloading dynamic function call syntax as well as predicate syntax: $array[[$position]] (was: $array($position)).</td></tr><tr><td>The functions keys() and members() were relaxed to take any sequence of items as parameters, performing implicit iteration, ignoring non-objects (keys) or non-arrays (members) (was: keys(object), members(array). Now: keys(item*), members(item*)).</td></tr><tr><td>New array unboxing syntax $array[], a shortcut for members($array). It also performs an implicit iteration.</td></tr><tr><td>Array lookup casts the position expression to an integer. Object lookup casts the key expression to a string (this reverts the change from 1.0.7)</td></tr></table>

				</td></tr><tr><td align="left">Revision 1-7</td><td align="left">Monday May 27th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Relaxed array and object navigation to make it more XPath-like. No more cast is done. Lookup on mixed sequences of items (with an implicit iteration) are allowed. The empty sequence is returned in case of mismatch, i.e. in case of (i) integer lookup on object/atomic or (ii) string lookup on array/atomic.</td></tr></table>

				</td></tr><tr><td align="left">Revision 1-6</td><td align="left">Friday May 24th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Reran all queries through a newer Zorba version (trunk 11475).</td></tr></table>

				</td></tr><tr><td align="left">Revision 1-5</td><td align="left">Thursday May 2nd, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Reran all queries through a newer Zorba version (trunk revision 11426).</td></tr><tr><td>Corrected some typos, like superfluous prefixes in function library sample queries.</td></tr></table>

				</td></tr><tr><td align="left">Revision 1-4</td><td align="left">Monday April 8th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Allowed the context item to appear unparenthesized in an object lookup expression.</td></tr><tr><td>Added the function parse-json()</td></tr></table>

				</td></tr><tr><td align="left">Revision 1-3</td><td align="left">Thursday April 4th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Fixed some typos.</td></tr></table>

				</td></tr><tr><td align="left">Revision 1-2</td><td align="left">Thursday April 4th, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Null are comparable with other atomic items and are considered the smallest.</td></tr><tr><td>Added link to semantics for all builtin functions inherited from XQuery.</td></tr><tr><td>Aggregated some examples.</td></tr></table>

				</td></tr><tr><td align="left">Revision 1-1</td><td align="left">Tuesday April 2nd, 2013</td><td align="left"><span class="author"><span class="firstname">Ghislain</span> <span class="surname">Fourny</span></span></td></tr><tr><td align="left" colspan="3">
					<table border="0" summary="Simple list" class="simplelist"><tr><td>Initial commit.</td></tr></table>

				</td></tr></table></div>

	</div></div><div class="index"><div class="titlepage"><div><div><h1 class="title"><a id="idm140319522770832"></a>Index</h1></div></div></div><div class="index"></div></div></div></body></html>